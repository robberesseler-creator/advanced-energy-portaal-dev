<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Personeelbeheer â€” Advanced Energy</title>
<style>
:root{--bg:#f1f5f9;--card:#fff;--border:#e2e8f0;--text1:#0f172a;--text2:#475569;--text3:#94a3b8;--accent:#3b82f6;--green:#16a34a;--greenbg:#dcfce7;--red:#ef4444;--redbg:#fee2e2;--yellow:#eab308;--yellowbg:#fefce8;--sidebar-w:240px;--radius:10px}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:var(--bg);color:var(--text1);display:flex;min-height:100vh}

/* Sidebar */
.sidebar{width:var(--sidebar-w);background:var(--card);border-right:1px solid var(--border);position:fixed;top:0;left:0;bottom:0;display:flex;flex-direction:column;z-index:10}
.sb-logo{padding:16px 18px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:10px;cursor:pointer}
.sb-logo-icon{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,#1e40af,#3b82f6);display:flex;align-items:center;justify-content:center;font-size:16px}
.sb-logo h2{font-size:14px;font-weight:700;color:var(--text1)}
.sb-logo p{font-size:10px;color:var(--text3)}
.sb-nav{flex:1;overflow-y:auto;padding:12px 10px}
.sb-section{font-size:10px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;padding:12px 8px 4px}
.sb-item{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:8px;border:none;background:none;width:100%;text-align:left;font-size:13px;font-weight:500;color:var(--text2);cursor:pointer;transition:all .15s;position:relative}
.sb-item:hover{background:#f1f5f9}
.sb-item.active{background:#eff6ff;color:var(--accent);font-weight:600}
.sb-item-icon{font-size:15px;width:20px;text-align:center}
.sb-badge{position:absolute;right:10px;background:var(--red);color:#fff;font-size:9px;font-weight:700;padding:1px 6px;border-radius:8px}
.sb-footer{padding:12px 18px;border-top:1px solid var(--border);font-size:10px;color:var(--text3)}

/* Main */
.main{margin-left:var(--sidebar-w);flex:1;min-height:100vh}
.panel{display:none}
.panel.active{display:block}

/* Shared components */
.page-header{background:var(--card);border-bottom:1px solid var(--border);padding:20px 24px}
.page-header h1{font-size:20px;font-weight:700;margin-bottom:4px}
.page-header .sub{font-size:12px;color:var(--text3)}
.stats{display:flex;gap:12px;margin-top:16px}
.stat{flex:1;border-radius:var(--radius);padding:12px 16px;border:1px solid transparent}
.stat-val{font-size:24px;font-weight:700}
.stat-label{font-size:10px;font-weight:600;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-top:2px}
.content{padding:20px 24px}
.card{background:var(--card);border-radius:var(--radius);border:1px solid var(--border);overflow:hidden;margin-bottom:16px}
.card-title{padding:14px 16px;font-weight:700;font-size:14px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:8px}
.card-body{padding:16px}
table{width:100%;border-collapse:collapse;font-size:13px}
th{text-align:left;padding:10px 14px;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:var(--text3);border-bottom:2px solid var(--border)}
th:last-child{text-align:right}
td{padding:10px 14px;border-bottom:1px solid #f1f5f9}
tr:hover td{background:#f8fafc}
.avatar{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-size:11px;font-weight:700;flex-shrink:0}
.person{display:flex;align-items:center;gap:8px}
.empty{text-align:center;padding:48px;color:var(--text3)}
.empty-icon{font-size:36px;margin-bottom:8px}
.tabs-row{display:flex;background:var(--card);border-bottom:1px solid var(--border);padding:0 24px}
.tab-btn{padding:11px 18px;border:none;border-bottom:2px solid transparent;background:none;color:var(--text3);font-weight:600;font-size:13px;cursor:pointer;display:flex;align-items:center;gap:6px}
.tab-btn.active{color:var(--accent);border-bottom-color:var(--accent)}
.tab-badge{background:var(--red);color:#fff;font-size:10px;font-weight:700;padding:1px 6px;border-radius:10px}
.filters{padding:14px 24px;display:flex;gap:6px;align-items:center;flex-wrap:wrap}
.fbtn{padding:5px 12px;border-radius:7px;border:1px solid var(--border);background:var(--card);color:var(--text2);font-size:12px;font-weight:500;cursor:pointer}
.fbtn.active{border-color:var(--accent);background:#eff6ff;color:var(--accent)}
.search{margin-left:auto;padding:6px 12px;border:1px solid var(--border);border-radius:7px;font-size:12px;width:180px;outline:none}
.badge{padding:3px 10px;border-radius:6px;font-size:12px;font-weight:600;white-space:nowrap}
.actions{display:flex;gap:4px;justify-content:flex-end}
.btn-a,.btn-r{padding:5px 12px;border-radius:6px;border:none;font-size:11px;font-weight:600;cursor:pointer}
.btn-a{background:var(--greenbg);color:var(--green)}
.btn-r{background:var(--redbg);color:var(--red)}
.btn-a:active,.btn-r:active{transform:scale(.95)}
.toast{position:fixed;top:16px;right:16px;background:var(--text1);color:#fff;padding:10px 20px;border-radius:8px;font-size:13px;font-weight:600;z-index:999;box-shadow:0 4px 12px rgba(0,0,0,.15);opacity:0;transition:opacity .3s;pointer-events:none}
.toast.show{opacity:1}
.footer{padding:8px 24px;font-size:11px;color:var(--text3);display:flex;justify-content:space-between}
.live{display:flex;align-items:center;gap:4px;color:var(--green);font-size:11px;font-weight:600}
.live-dot{width:6px;height:6px;border-radius:50%;background:var(--green);animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
.loading{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh}
.spinner{width:36px;height:36px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

/* Wallchart specific */
.wc-nav{display:flex;gap:6px;align-items:center;margin-top:16px}
.wc-btn{padding:6px 14px;border:1px solid var(--border);border-radius:7px;background:var(--card);font-size:12px;font-weight:600;cursor:pointer;color:var(--text2)}
.wc-label{font-weight:700;font-size:14px;min-width:140px;text-align:center}
.wc-table{font-size:11px;min-width:900px}
.wc-table th{padding:6px 2px;font-size:10px}
.wc-table td.name{text-align:left;padding:6px 10px;font-weight:600;font-size:12px;white-space:nowrap;border-right:1px solid var(--border);position:sticky;left:0;background:var(--card);z-index:1}
.wc-table td.day{width:28px;min-width:28px;height:30px;padding:1px;border-right:1px solid #f8fafc;border-bottom:1px solid #f8fafc}
.wc-table td.weekend{background:#fafafa}
.wc-table td.today-col{background:#eff6ff22}
.wc-block{width:100%;height:22px;border-radius:3px;display:flex;align-items:center;justify-content:center;font-size:8px;font-weight:700;color:#fff}
.dept-row td{background:#f8fafc;padding:5px 10px;font-weight:700;font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:.5px}
.legend{display:flex;gap:12px;flex-wrap:wrap;font-size:11px;margin-top:12px}
.legend-item{display:flex;align-items:center;gap:4px}
.legend-dot{width:12px;height:12px;border-radius:3px}

/* People table */
.person-card{display:flex;gap:20px;flex-wrap:wrap}
.p-card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:16px;min-width:280px;flex:1}
.p-card-name{font-weight:700;font-size:15px;margin-bottom:2px}
.p-card-dept{font-size:12px;color:var(--text3)}
.p-card-row{display:flex;justify-content:space-between;font-size:12px;padding:4px 0;border-bottom:1px solid #f8fafc}
</style>
</head>
<body>

<nav class="sidebar">
  <div class="sb-logo" onclick="nav('dashboard')">
    <div class="sb-logo-icon">âš¡</div>
    <div><h2>Personeelbeheer</h2><p>Advanced Energy</p></div>
  </div>
  <div class="sb-nav">
    <div class="sb-section">Overzicht</div>
    <button class="sb-item active" data-page="dashboard" onclick="nav('dashboard')"><span class="sb-item-icon">ğŸ“Š</span>Dashboard</button>
    <button class="sb-item" data-page="wallchart" onclick="nav('wallchart')"><span class="sb-item-icon">ğŸ—“</span>Wallchart</button>
    <div class="sb-section">Beheer</div>
    <button class="sb-item" data-page="requests" onclick="nav('requests')"><span class="sb-item-icon">ğŸ“¥</span>Aanvragen<span class="sb-badge" id="badge-req" style="display:none">0</span></button>
    <button class="sb-item" data-page="people" onclick="nav('people')"><span class="sb-item-icon">ğŸ‘¥</span>Medewerkers</button>
    <button class="sb-item" data-page="sickness" onclick="nav('sickness')"><span class="sb-item-icon">ğŸ¤’</span>Ziekte</button>
  </div>
  <div class="sb-footer">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <span>Personeelbeheer v2.0</span>
      <span class="live"><span class="live-dot"></span>Live</span>
    </div>
  </div>
</nav>

<div class="main">
  <div class="panel active" id="page-dashboard"><div class="loading"><div class="spinner"></div><p style="color:#64748b;font-size:14px;margin-top:16px">Laden...</p></div></div>
  <div class="panel" id="page-wallchart"></div>
  <div class="panel" id="page-requests"></div>
  <div class="panel" id="page-people"></div>
  <div class="panel" id="page-sickness"></div>
</div>

<div id="toast" class="toast"></div>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script>
firebase.initializeApp({apiKey:"AIzaSyBKU-wCjV4Au4ngRG52Zmmxbzc3N3D8VBU",authDomain:"advanced-intranet.firebaseapp.com",projectId:"advanced-intranet",storageBucket:"advanced-intranet.firebasestorage.app",messagingSenderId:"309856938024",appId:"1:309856938024:web:2108715f92c5dea2da2d1d"});
var db=firebase.firestore();

// â•â•â• STATE â•â•â•
var people=[],departments=[],leaveTypes=[],requests=[];
var activePage='dashboard',reqFilter='pending',sickFilter='active',reqSearch='';
var wcDate=new Date();

// â•â•â• HELPERS â•â•â•
var COLORS=["#3b82f6","#22c55e","#a855f7","#ef4444","#eab308","#ec4899","#06b6d4","#f97316"];
function ac(n){var h=0;for(var i=0;i<(n||'').length;i++)h=n.charCodeAt(i)+((h<<5)-h);return COLORS[Math.abs(h)%COLORS.length]}
function ini(n){return(n||'?').split(' ').map(function(w){return w[0]}).join('').toUpperCase().slice(0,2)}
function gN(id){var p=people.find(function(x){return x.id===id});return p?p.firstName+' '+p.lastName:'?'}
function gD(id){var p=people.find(function(x){return x.id===id});if(!p)return'';var d=departments.find(function(x){return x.id===p.departmentId});return d?d.name:''}
function gT(id){return leaveTypes.find(function(t){return t.id===id})||{name:id,symbol:'ğŸ“‹',color:'#94a3b8'}}
function fD(d){try{return new Date(d).toLocaleDateString('nl-BE',{day:'2-digit',month:'short'})}catch(e){return d}}
function td(){return new Date().toISOString().split('T')[0]}
function dB(a,b){return Math.max(1,Math.round((new Date(b)-new Date(a))/86400000)+1)}
function toast(m){var t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(function(){t.classList.remove('show')},2500)}
function statusBadge(s){var m={pending:['#fef3c7','#92400e','â³ Openstaand'],approved:['#dcfce7','#166534','âœ… Goedgekeurd'],rejected:['#fee2e2','#991b1b','âŒ Geweigerd']};var v=m[s]||m.pending;return'<span class="badge" style="background:'+v[0]+';color:'+v[1]+'">'+v[2]+'</span>'}

var HOLIDAYS=[{n:'Paasmaandag',d:'2026-04-06'},{n:'Dag v/d Arbeid',d:'2026-05-01'},{n:'O.L.H. Hemelvaart',d:'2026-05-14'},{n:'Pinkstermaandag',d:'2026-05-25'},{n:'Vlaamse feestdag',d:'2026-07-11'},{n:'Nationale feestdag',d:'2026-07-21'},{n:'O.L.V. Hemelvaart',d:'2026-08-15'},{n:'Allerheiligen',d:'2026-11-01'},{n:'Wapenstilstand',d:'2026-11-11'},{n:'Kerstmis',d:'2026-12-25'}];
var HOL_DATES=HOLIDAYS.map(function(h){return h.d});

// â•â•â• NAVIGATION â•â•â•
function nav(page){
  activePage=page;
  document.querySelectorAll('.panel').forEach(function(p){p.classList.remove('active')});
  document.getElementById('page-'+page).classList.add('active');
  document.querySelectorAll('.sb-item').forEach(function(b){b.classList.remove('active')});
  document.querySelectorAll('.sb-item[data-page="'+page+'"]').forEach(function(b){b.classList.add('active')});
  renderPage();
}

// â•â•â• SAVE â•â•â•
function saveReqs(){db.collection('platform').doc('personeelbeheer').update({requests:JSON.stringify(requests),updatedAt:new Date().toISOString()}).catch(function(e){console.error(e)})}
function approve(id){requests=requests.map(function(r){return r.id===id?Object.assign({},r,{status:'approved'}):r});saveReqs();toast('âœ… Goedgekeurd: '+gN(requests.find(function(r){return r.id===id}).personId));renderPage()}
function reject(id){requests=requests.map(function(r){return r.id===id?Object.assign({},r,{status:'rejected'}):r});saveReqs();toast('âŒ Geweigerd: '+gN(requests.find(function(r){return r.id===id}).personId));renderPage()}

// â•â•â• RENDER ROUTER â•â•â•
function renderPage(){
  if(activePage==='dashboard')renderDashboard();
  if(activePage==='requests')renderRequests();
  if(activePage==='sickness')renderSickness();
  if(activePage==='wallchart')renderWallchart();
  if(activePage==='people')renderPeople();
  // Update badge
  var pend=requests.filter(function(r){return r.status==='pending'&&r.type!=='ziekte'}).length;
  var b=document.getElementById('badge-req');
  if(pend>0){b.textContent=pend;b.style.display='';}else{b.style.display='none';}
}

// â•â•â• DASHBOARD â•â•â•
function renderDashboard(){
  var t=td();
  var appr=requests.filter(function(r){return r.status==='approved'&&r.startDate<=t&&r.endDate>=t});
  var absent=appr.filter(function(r){return r.type!=='ziekte'});
  var sick=appr.filter(function(r){return r.type==='ziekte'});
  var pend=requests.filter(function(r){return r.status==='pending'&&r.type!=='ziekte'});
  var upcoming=HOLIDAYS.filter(function(h){return h.d>=t}).slice(0,5);

  var h='<div class="page-header"><h1>Dashboard</h1><p class="sub">Overzicht verlof en afwezigheden</p>';
  h+='<div class="stats">';
  h+='<div class="stat" style="background:#eff6ff;border-color:#3b82f622"><div class="stat-val" style="color:#3b82f6">'+absent.length+'</div><div class="stat-label">Afwezig vandaag</div></div>';
  h+='<div class="stat" style="background:#fef2f2;border-color:#ef444422"><div class="stat-val" style="color:#ef4444">'+sick.length+'</div><div class="stat-label">Ziek vandaag</div></div>';
  h+='<div class="stat" style="background:#fefce8;border-color:#eab30822"><div class="stat-val" style="color:#eab308">'+pend.length+'</div><div class="stat-label">Openstaande aanvragen</div></div>';
  h+='</div></div><div class="content" style="display:flex;gap:16px;flex-wrap:wrap">';

  // Afwezig
  h+='<div class="card" style="flex:1;min-width:300px"><div class="card-title">ğŸ“… Afwezig vandaag</div><div class="card-body">';
  if(absent.length===0&&sick.length===0)h+='<div style="color:var(--text3);font-size:13px">Niemand afwezig</div>';
  absent.forEach(function(r){var n=gN(r.personId),tp=gT(r.type);h+='<div style="display:flex;align-items:center;gap:10px;padding:6px 0;border-bottom:1px solid #f1f5f9"><div class="avatar" style="background:'+ac(n)+'">'+ini(n)+'</div><div><div style="font-weight:600;font-size:13px">'+n+'</div><div style="font-size:11px;color:var(--text3)">'+gD(r.personId)+'</div></div><span class="badge" style="margin-left:auto;background:'+tp.color+'15;color:'+tp.color+'">'+tp.symbol+' '+tp.name+'</span></div>'});
  if(sick.length>0){h+='<div style="font-size:11px;font-weight:700;color:var(--text3);text-transform:uppercase;margin:12px 0 6px;padding-top:8px;border-top:1px solid #f1f5f9">ğŸ¤’ Ziek vandaag</div>';
  sick.forEach(function(r){var n=gN(r.personId);h+='<div style="display:flex;align-items:center;gap:10px;padding:6px 0"><div class="avatar" style="background:'+ac(n)+'">'+ini(n)+'</div><div><div style="font-weight:600;font-size:13px">'+n+'</div><div style="font-size:11px;color:var(--text3)">'+gD(r.personId)+' Â· sinds '+fD(r.startDate)+'</div></div></div>'});}
  h+='</div></div>';

  // Pending
  h+='<div class="card" style="flex:1;min-width:300px"><div class="card-title">ğŸ“¥ Openstaande aanvragen</div><div class="card-body">';
  if(pend.length===0)h+='<div style="color:var(--text3);font-size:13px">Geen openstaande aanvragen</div>';
  pend.slice(0,8).forEach(function(r){var n=gN(r.personId),tp=gT(r.type);h+='<div style="display:flex;align-items:center;gap:10px;padding:6px 0;border-bottom:1px solid #f1f5f9"><div class="avatar" style="background:'+ac(n)+'">'+ini(n)+'</div><div><div style="font-weight:600;font-size:13px">'+n+'</div><div style="font-size:11px;color:var(--text3)">'+fD(r.startDate)+' â†’ '+fD(r.endDate)+'</div></div><span class="badge" style="margin-left:auto;background:'+tp.color+'15;color:'+tp.color+'">'+tp.symbol+'</span><div class="actions"><button class="btn-a" onclick="approve(\''+r.id+'\')">âœ…</button><button class="btn-r" onclick="reject(\''+r.id+'\')">âŒ</button></div></div>'});
  h+='</div></div>';

  // Feestdagen
  h+='<div class="card" style="flex-basis:100%"><div class="card-title">ğŸ‡§ğŸ‡ª Aankomende feestdagen</div><div class="card-body">';
  upcoming.forEach(function(ho){h+='<div style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #f1f5f9;font-size:13px"><span>ğŸ‡§ğŸ‡ª '+ho.n+'</span><span style="color:var(--text3);font-size:12px">'+new Date(ho.d).toLocaleDateString('nl-BE',{day:'2-digit',month:'2-digit',year:'numeric'})+'</span></div>'});
  h+='</div></div></div>';
  document.getElementById('page-dashboard').innerHTML=h;
}

// â•â•â• AANVRAGEN â•â•â•
function setReqFilter(f){reqFilter=f;renderRequests()}
function setReqSearch(v){reqSearch=v;renderRequests()}
function renderRequests(){
  var t=td(),nonS=requests.filter(function(r){return r.type!=='ziekte'});
  var pend=nonS.filter(function(r){return r.status==='pending'}).length;
  var fl=nonS;
  if(reqFilter!=='all')fl=fl.filter(function(r){return r.status===reqFilter});
  if(reqSearch){var q=reqSearch.toLowerCase();fl=fl.filter(function(r){return gN(r.personId).toLowerCase().includes(q)})}
  fl.sort(function(a,b){return new Date(b.startDate)-new Date(a.startDate)});

  var h='<div class="page-header"><h1>ğŸ“¥ Aanvragen</h1><p class="sub">Verlofaanvragen beheren</p>';
  h+='<div class="stats"><div class="stat" style="background:#fefce8;border-color:#eab30822"><div class="stat-val" style="color:#eab308">'+pend+'</div><div class="stat-label">Openstaand</div></div>';
  h+='<div class="stat" style="background:#f8fafc;border-color:#64748b22"><div class="stat-val" style="color:#64748b">'+nonS.length+'</div><div class="stat-label">Totaal</div></div></div></div>';
  h+='<div class="filters">';
  [{id:'pending',l:'â³ Openstaand'},{id:'approved',l:'âœ… Goedgekeurd'},{id:'rejected',l:'âŒ Geweigerd'},{id:'all',l:'Alles'}].forEach(function(f){
    h+='<button class="fbtn'+(reqFilter===f.id?' active':'')+'" onclick="setReqFilter(\''+f.id+'\')">'+f.l+'</button>';
  });
  h+='<input class="search" type="text" placeholder="ğŸ” Zoek..." value="'+reqSearch+'" oninput="setReqSearch(this.value)"/></div>';
  h+='<div class="content"><div class="card">';
  if(fl.length===0){h+='<div class="empty"><div class="empty-icon">ğŸ“­</div>Geen aanvragen gevonden</div>';}
  else{h+='<table><thead><tr><th>Medewerker</th><th>Afdeling</th><th>Type</th><th>Periode</th><th>Dagen</th><th>Status</th><th style="text-align:right">Acties</th></tr></thead><tbody>';
  fl.forEach(function(r){var n=gN(r.personId),tp=gT(r.type);
    h+='<tr><td><div class="person"><div class="avatar" style="background:'+ac(n)+'">'+ini(n)+'</div><div><div style="font-weight:600">'+n+'</div>'+(r.comment?'<div style="font-size:11px;color:var(--text3)">ğŸ’¬ '+r.comment+'</div>':'')+'</div></div></td>';
    h+='<td style="color:var(--text3);font-size:12px">'+gD(r.personId)+'</td>';
    h+='<td><span style="background:'+tp.color+'15;color:'+tp.color+';padding:3px 10px;border-radius:6px;font-size:12px">'+tp.symbol+' '+tp.name+'</span></td>';
    h+='<td style="font-size:12px;white-space:nowrap">'+fD(r.startDate)+(r.startDate!==r.endDate?' â†’ '+fD(r.endDate):'')+'</td>';
    h+='<td style="font-weight:600">'+(r.halfDay?'Â½ dag':(r.days||1)+'d')+'</td>';
    h+='<td>'+statusBadge(r.status)+'</td>';
    h+='<td style="text-align:right">'+(r.status==='pending'?'<div class="actions"><button class="btn-a" onclick="approve(\''+r.id+'\')">âœ… Goedkeuren</button><button class="btn-r" onclick="reject(\''+r.id+'\')">âŒ Weigeren</button></div>':'')+'</td></tr>';
  });h+='</tbody></table>';}
  h+='</div><div class="footer"><span>'+fl.length+' aanvra'+(fl.length===1?'ag':'gen')+'</span><span>Real-time sync ğŸŸ¢</span></div></div>';
  document.getElementById('page-requests').innerHTML=h;
}

// â•â•â• ZIEKTE â•â•â•
function setSickFilter(f){sickFilter=f;renderSickness()}
function renderSickness(){
  var t=td(),sick=requests.filter(function(r){return r.type==='ziekte'});
  var active=sick.filter(function(r){return r.startDate<=t&&r.endDate>=t});
  var fl=sickFilter==='active'?active:sick;
  fl.sort(function(a,b){return new Date(b.startDate)-new Date(a.startDate)});

  var h='<div class="page-header"><h1>ğŸ¤’ Ziekte</h1><p class="sub">Ziekmeldingen en Bradford Factor</p>';
  h+='<div class="stats"><div class="stat" style="background:#fef2f2;border-color:#ef444422"><div class="stat-val" style="color:#ef4444">'+active.length+'</div><div class="stat-label">Actief ziek</div></div>';
  h+='<div class="stat" style="background:#fefce8;border-color:#eab30822"><div class="stat-val" style="color:#eab308">'+sick.length+'</div><div class="stat-label">Totaal</div></div></div></div>';
  h+='<div class="filters">';
  h+='<button class="fbtn'+(sickFilter==='active'?' active':'')+'" onclick="setSickFilter(\'active\')">ğŸ¤’ Actief ziek'+(active.length>0?' ('+active.length+')':'')+'</button>';
  h+='<button class="fbtn'+(sickFilter==='all'?' active':'')+'" onclick="setSickFilter(\'all\')">Alle meldingen</button></div>';
  h+='<div class="content"><div class="card">';
  if(fl.length===0){h+='<div class="empty"><div class="empty-icon">ğŸ‰</div>Geen ziekmeldingen</div>';}
  else{h+='<table><thead><tr><th>Medewerker</th><th>Afdeling</th><th>Van</th><th>Tot</th><th>Dagen</th><th>Status</th></tr></thead><tbody>';
  fl.forEach(function(r){var n=gN(r.personId),isA=r.startDate<=t&&r.endDate>=t;
    h+='<tr><td><div class="person"><div class="avatar" style="background:'+ac(n)+'">'+ini(n)+'</div><span style="font-weight:600">'+n+'</span></div></td>';
    h+='<td style="color:var(--text3);font-size:12px">'+gD(r.personId)+'</td><td style="font-size:12px">'+fD(r.startDate)+'</td><td style="font-size:12px">'+fD(r.endDate)+'</td>';
    h+='<td style="font-weight:600">'+dB(r.startDate,r.endDate)+'d</td>';
    h+='<td>'+(isA?'<span class="badge" style="background:#fef2f2;color:#991b1b">ğŸ”´ Actief</span>':'<span class="badge" style="background:#f1f5f9;color:#64748b">Afgerond</span>')+'</td></tr>';
  });h+='</tbody></table>';}
  h+='</div></div>';
  document.getElementById('page-sickness').innerHTML=h;
}

// â•â•â• WALLCHART â•â•â•
function wcPrev(){wcDate.setMonth(wcDate.getMonth()-1);renderWallchart()}
function wcNext(){wcDate.setMonth(wcDate.getMonth()+1);renderWallchart()}
function wcToday(){wcDate=new Date();renderWallchart()}
function renderWallchart(){
  var y=wcDate.getFullYear(),m=wcDate.getMonth(),dim=new Date(y,m+1,0).getDate();
  var todayStr=td(),mNames=['Januari','Februari','Maart','April','Mei','Juni','Juli','Augustus','September','Oktober','November','December'];
  var dNames=['zo','ma','di','wo','do','vr','za'];
  var actP=people.filter(function(p){return!p.archived});
  var grp={};departments.forEach(function(d){grp[d.id]={name:d.name,ppl:[]}});
  actP.forEach(function(p){if(grp[p.departmentId])grp[p.departmentId].ppl.push(p)});

  var h='<div class="page-header"><h1>ğŸ—“ Wallchart</h1><div class="wc-nav"><button class="wc-btn" onclick="wcPrev()">â—€</button><div class="wc-label">'+mNames[m]+' '+y+'</div><button class="wc-btn" onclick="wcNext()">â–¶</button><button class="wc-btn" onclick="wcToday()" style="margin-left:8px">Vandaag</button></div></div>';
  h+='<div class="content" style="overflow-x:auto"><div class="card"><table class="wc-table"><thead><tr><th style="text-align:left;padding:6px 10px;min-width:140px">Medewerker</th>';
  for(var d=1;d<=dim;d++){var dt=new Date(y,m,d),ds=dt.toISOString().split('T')[0],dow=dt.getDay(),we=dow===0||dow===6,it=ds===todayStr;
    h+='<th style="'+(we?'background:#fef2f2;':'')+(it?'background:#eff6ff;color:var(--accent);font-weight:700;':'')+'">'+dNames[dow]+'<br>'+d+'</th>';}
  h+='</tr></thead><tbody>';
  Object.keys(grp).forEach(function(did){var dp=grp[did];if(dp.ppl.length===0)return;
    h+='<tr class="dept-row"><td colspan="'+(dim+1)+'">'+dp.name+' ('+dp.ppl.length+')</td></tr>';
    dp.ppl.forEach(function(p){var nm=p.firstName+' '+p.lastName;
      h+='<tr><td class="name">'+nm+'</td>';
      for(var d=1;d<=dim;d++){var dt=new Date(y,m,d),ds=dt.toISOString().split('T')[0],dow=dt.getDay(),we=dow===0||dow===6,it=ds===todayStr;
        var rq=requests.find(function(r){return r.personId===p.id&&r.status==='approved'&&r.startDate<=ds&&r.endDate>=ds});
        var ih=HOL_DATES.indexOf(ds)!==-1;
        h+='<td class="day'+(we?' weekend':'')+(it?' today-col':'')+'">';
        if(ih)h+='<div class="wc-block" style="background:#94a3b8">ğŸ‡§ğŸ‡ª</div>';
        else if(rq){var tp=gT(rq.type);h+='<div class="wc-block" style="background:'+(rq.type==='ziekte'?'#ef4444':tp.color)+'" title="'+tp.name+'">'+tp.symbol+'</div>';}
        h+='</td>';}
      h+='</tr>';});});
  h+='</tbody></table></div>';
  h+='<div class="legend">';leaveTypes.slice(0,6).forEach(function(t){h+='<div class="legend-item"><div class="legend-dot" style="background:'+t.color+'"></div>'+t.symbol+' '+t.name+'</div>'});
  h+='<div class="legend-item"><div class="legend-dot" style="background:#94a3b8"></div>ğŸ‡§ğŸ‡ª Feestdag</div></div></div>';
  document.getElementById('page-wallchart').innerHTML=h;
}

// â•â•â• MEDEWERKERS â•â•â•
function renderPeople(){
  var actP=people.filter(function(p){return!p.archived});
  var h='<div class="page-header"><h1>ğŸ‘¥ Medewerkers</h1><p class="sub">'+actP.length+' actieve medewerkers</p></div>';
  h+='<div class="content"><div class="card"><table><thead><tr><th>Naam</th><th>Afdeling</th><th>Rol</th><th>Email</th><th>Startdatum</th></tr></thead><tbody>';
  actP.sort(function(a,b){return(a.firstName+a.lastName).localeCompare(b.firstName+b.lastName)});
  actP.forEach(function(p){var n=p.firstName+' '+p.lastName;
    h+='<tr><td><div class="person"><div class="avatar" style="background:'+ac(n)+'">'+ini(n)+'</div><span style="font-weight:600">'+n+'</span></div></td>';
    h+='<td style="font-size:12px">'+gD(p.id)+'</td>';
    h+='<td style="font-size:12px">'+(p.role==='admin'?'<span class="badge" style="background:#eff6ff;color:var(--accent)">Admin</span>':'Gebruiker')+'</td>';
    h+='<td style="font-size:12px;color:var(--text3)">'+(p.email||'')+'</td>';
    h+='<td style="font-size:12px;color:var(--text3)">'+(p.startDate?fD(p.startDate):'')+'</td></tr>';
  });
  h+='</tbody></table></div></div>';
  document.getElementById('page-people').innerHTML=h;
}

// â•â•â• FIRESTORE LISTENER â•â•â•
db.collection('platform').doc('personeelbeheer').onSnapshot(function(doc){
  if(!doc.exists){document.getElementById('page-dashboard').innerHTML='<div class="empty"><div class="empty-icon">ğŸ“­</div>Geen data in Firestore</div>';return;}
  var d=doc.data();
  if(d.people)people=JSON.parse(d.people);
  if(d.departments)departments=JSON.parse(d.departments);
  if(d.leaveTypes)leaveTypes=JSON.parse(d.leaveTypes);
  if(d.requests)requests=JSON.parse(d.requests);
  renderPage();
},function(err){
  document.getElementById('page-dashboard').innerHTML='<div class="empty"><div class="empty-icon">âš ï¸</div>Verbinding mislukt: '+err.message+'</div>';
});
</script>
</body>
</html>
