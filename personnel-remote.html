<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#1E3A5F">
<title>Advanced Energy â€” Verlof</title>
<!-- Firebase SDK via cdnjs (alternatief CDN) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/10.12.2/firebase-app-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/10.12.2/firebase-firestore-compat.js"></script>
<script>
// Fallback: als cdnjs niet werkt, probeer gstatic
if(typeof firebase==='undefined'){
  document.write('<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"><\/script>');
  document.write('<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"><\/script>');
}
</script>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,600;0,9..40,700;0,9..40,800;1,9..40,400&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%;overflow:hidden}
body{font-family:'DM Sans','Nunito',-apple-system,BlinkMacSystemFont,sans-serif;background:#F5F6F8}
#root{max-width:430px;margin:0 auto;min-height:100vh;height:100vh;background:#F5F6F8;position:relative;overflow:hidden;display:flex;flex-direction:column}
.screen{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;padding-bottom:80px}
input,textarea,select,button{font-family:inherit}
@keyframes slideUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
.slide-up{animation:slideUp .3s ease}
</style>
</head>
<body>
<div id="root"></div>
<!-- Firebase Init -->
<script>
console.log('ğŸ”¥ Firebase check:', typeof firebase);
if(typeof firebase!=='undefined'){
  if(!firebase.apps.length) firebase.initializeApp({
    apiKey:"AIzaSyBKU-wCjV4Au4ngRG52Zmmxbzc3N3D8VBU",
    authDomain:"advanced-intranet.firebaseapp.com",
    projectId:"advanced-intranet",
    storageBucket:"advanced-intranet.firebasestorage.app",
    messagingSenderId:"309856938024",
    appId:"1:309856938024:web:2108715f92c5dea2da2d1d"
  });
  window.fsDb=firebase.firestore();
  console.log('âœ… Firebase + Firestore ready');
} else {
  console.error('âŒ Firebase SDK niet geladen! Check netwerk/CDN.');
  document.getElementById('root').innerHTML='<div style="padding:40px;text-align:center;color:red;font-family:sans-serif"><h2>Firebase kon niet laden</h2><p>Check je internetverbinding en herlaad de pagina.</p></div>';
}
</script>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script type="text/babel">
const {useState, useEffect, useCallback, useRef} = React;
const fsDb = window.fsDb;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIREBASE SYNC LAYER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Voorlopig hardcoded user ID â€” wordt later vervangen door Firebase Auth
const CURRENT_USER_ID = null; // auto-detect eerste persoon, of stel in op specifiek id

const EMPTY_SYNC_DATA = {
  leaveTypes: [], user: null, balances: {}, requests: [], requestsPreviousYear: [],
  team: [], teamAbsences: [], notifications: [], lastSync: null
};

// Bereken saldo's op basis van personeelbeheer logica
function calcBalances(person, leaveTypes, requests) {
  const currentYear = new Date().getFullYear();
  const prevYear = currentYear - 1;
  const balances = {};

  [currentYear, prevYear].forEach(year => {
    balances[year] = {};
    leaveTypes.filter(t => t.tracked).forEach(t => {
      let allowance = t.defaultDays || 0;
      if (person.allowanceAdjustments) {
        person.allowanceAdjustments.forEach(a => {
          if (a.typeId === t.id) allowance += a.days;
        });
      }
      const used = requests
        .filter(r => r.personId === person.id && r.type === t.id &&
          (r.status === 'approved' || r.type === 'ziekte') &&
          new Date(r.startDate).getFullYear() === year)
        .reduce((sum, r) => sum + (r.halfDay ? 0.5 : (r.days || 0)), 0);
      balances[year][t.id] = { allowance, used, remaining: allowance - used };
    });
  });
  return balances;
}

// Bouw syncData op uit Firestore personeelbeheer document
function buildSyncData(people, departments, leaveTypes, allRequests, person) {
  if (!person) return EMPTY_SYNC_DATA;

  const dept = departments.find(d => d.id === person.departmentId);
  const currentYear = new Date().getFullYear();
  const prevYear = currentYear - 1;

  // Eigen requests splitsen per jaar
  const myRequests = allRequests.filter(r => r.personId === person.id);
  const requestsCurrent = myRequests.filter(r => new Date(r.startDate).getFullYear() === currentYear);
  const requestsPrev = myRequests.filter(r => new Date(r.startDate).getFullYear() === prevYear);

  // Team = zelfde department
  const team = people.filter(p => p.id !== person.id && p.departmentId === person.departmentId)
    .map(p => ({ id: p.id, firstName: p.firstName, lastName: p.lastName, departmentId: p.departmentId, departmentName: dept ? dept.name : '' }));

  // Team absences = goedgekeurde/pending requests van teamleden rond vandaag
  const today = new Date();
  const twoWeeksAgo = new Date(today); twoWeeksAgo.setDate(today.getDate() - 7);
  const twoWeeksAhead = new Date(today); twoWeeksAhead.setDate(today.getDate() + 14);
  const teamAbsences = [];
  team.forEach(t => {
    allRequests.filter(r => r.personId === t.id && (r.status === 'approved' || r.status === 'pending') &&
      new Date(r.endDate) >= twoWeeksAgo && new Date(r.startDate) <= twoWeeksAhead)
      .forEach(r => {
        teamAbsences.push({ personId: t.id, firstName: t.firstName, lastName: t.lastName, type: r.type, startDate: r.startDate, endDate: r.endDate });
      });
  });

  const balances = calcBalances(person, leaveTypes, allRequests);

  return {
    leaveTypes,
    user: {
      id: person.id, firstName: person.firstName, lastName: person.lastName,
      email: person.email || '', departmentId: person.departmentId,
      departmentName: dept ? dept.name : '', role: 'user',
      statuut: person.statuut || 'arbeider',
      gsm: person.gsm || '', tel: person.tel || '', werkGsm: person.werkGsm || '',
      scheduleId: person.scheduleId || 'fulltime', startDate: person.startDate || '',
      noodNaam: person.noodNaam || '', noodRelatie: person.noodRelatie || '', noodGsm: person.noodGsm || '',
      iban: person.iban || '', birthDate: person.birthDate || '', rrn: person.rrn || '',
    },
    balances,
    requests: requestsCurrent.sort((a, b) => new Date(b.requestDate || b.startDate) - new Date(a.requestDate || a.startDate)),
    requestsPreviousYear: requestsPrev.sort((a, b) => new Date(b.requestDate || b.startDate) - new Date(a.requestDate || a.startDate)),
    team, teamAbsences,
    notifications: [],
    lastSync: new Date().toISOString()
  };
}

function useSyncData() {
  const [syncData, setSyncData] = useState(EMPTY_SYNC_DATA);
  const [syncing, setSyncing] = useState(true);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const rawRef = useRef({ people: [], departments: [], leaveTypes: [], requests: [], person: null });

  const loadFromFirestore = useCallback(async () => {
    setSyncing(true);
    try {
      const doc = await fsDb.collection('platform').doc('personeelbeheer').get();
      if (!doc.exists) { setError('Geen personeelbeheer data gevonden in Firestore'); setSyncing(false); setLoading(false); return; }
      const data = doc.data();
      const people = data.people ? JSON.parse(data.people) : [];
      const departments = data.departments ? JSON.parse(data.departments) : [];
      const leaveTypes = data.leaveTypes ? JSON.parse(data.leaveTypes) : [];
      const requests = data.requests ? JSON.parse(data.requests) : [];

      // Zoek huidige gebruiker â€” later via Firebase Auth
      let person = null;
      if (CURRENT_USER_ID) {
        person = people.find(p => p.id === CURRENT_USER_ID);
      } else {
        // Auto-detect: neem eerste actieve persoon
        person = people.find(p => p.active !== false) || people[0];
      }

      rawRef.current = { people, departments, leaveTypes, requests, person };
      const sd = buildSyncData(people, departments, leaveTypes, requests, person);
      setSyncData(sd);
      setError(null);
      console.log('âœ… Remote app: data geladen van Firestore', person ? `(${person.firstName} ${person.lastName})` : '');
    } catch (e) {
      console.error('Remote Firestore load error', e);
      setError('Kan niet verbinden met Firestore: ' + e.message);
    }
    setSyncing(false);
    setLoading(false);
  }, []);

  useEffect(() => { loadFromFirestore(); }, [loadFromFirestore]);

  const refreshSync = useCallback(async () => { await loadFromFirestore(); }, [loadFromFirestore]);

  const submitRequest = useCallback(async (request) => {
    try {
      const { people, departments, leaveTypes, requests, person } = rawRef.current;
      // Voeg request toe
      const newRequest = { ...request, id: 'r-' + Date.now().toString(36), personId: person.id, status: 'pending', requestDate: new Date().toISOString().split('T')[0] };
      const updatedRequests = [newRequest, ...requests];
      // Schrijf naar Firestore
      await fsDb.collection('platform').doc('personeelbeheer').update({
        requests: JSON.stringify(updatedRequests),
        updatedAt: new Date().toISOString()
      });
      // Update lokale state
      rawRef.current.requests = updatedRequests;
      const sd = buildSyncData(people, departments, leaveTypes, updatedRequests, person);
      setSyncData(sd);
      console.log('âœ… Remote: aanvraag opgeslagen in Firestore');
      return { success: true };
    } catch (e) {
      console.error('Submit request error', e);
      return { success: false, error: e.message };
    }
  }, []);

  const cancelRequest = useCallback(async (requestId) => {
    try {
      const { people, departments, leaveTypes, requests, person } = rawRef.current;
      const updatedRequests = requests.filter(r => r.id !== requestId);
      await fsDb.collection('platform').doc('personeelbeheer').update({
        requests: JSON.stringify(updatedRequests),
        updatedAt: new Date().toISOString()
      });
      rawRef.current.requests = updatedRequests;
      const sd = buildSyncData(people, departments, leaveTypes, updatedRequests, person);
      setSyncData(sd);
      console.log('âœ… Remote: aanvraag geannuleerd in Firestore');
      return { success: true };
    } catch (e) {
      console.error('Cancel request error', e);
      return { success: false, error: e.message };
    }
  }, []);

  return { syncData, syncing, loading, error, refreshSync, submitRequest, cancelRequest };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILITY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const fullName = (p) => `${p.firstName} ${p.lastName}`;
const getInitials = (p) => `${(p.firstName||"")[0]||""}${(p.lastName||"")[0]||""}`.toUpperCase();
const formatDate = (d) => new Date(d+"T00:00:00").toLocaleDateString("nl-BE",{day:"numeric",month:"short"});
const formatDateFull = (d) => new Date(d+"T00:00:00").toLocaleDateString("nl-BE",{weekday:"short",day:"numeric",month:"long",year:"numeric"});
const getDaysBetween = (s,e) => Math.max(1, Math.round((new Date(e)-new Date(s))/86400000)+1);
const todayStr = () => new Date().toISOString().split("T")[0];
const AVATAR_COLORS = ["#3b82f6","#22c55e","#a855f7","#ef4444","#eab308","#ec4899","#06b6d4","#f97316"];
const getAvatarColor = (name) => AVATAR_COLORS[Math.abs([...name].reduce((h,c)=>((h<<5)-h+c.charCodeAt(0))|0,0)) % AVATAR_COLORS.length];
const getRequestableTypes = (lt) => lt.filter(t => t.category!=="ziekte" && t.category!=="extern" && t.category!=="overuren");

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COMPONENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function StatusBadge({status}) {
  const cfg = { approved:{bg:"#D1FAE5",color:"#065F46",label:"Goedgekeurd"}, pending:{bg:"#FEF3C7",color:"#92400E",label:"In afwachting"}, rejected:{bg:"#FEE2E2",color:"#991B1B",label:"Afgewezen"} };
  const c = cfg[status]||cfg.pending;
  return <span style={{background:c.bg,color:c.color,padding:"3px 10px",borderRadius:20,fontSize:11,fontWeight:600,letterSpacing:.3}}>{c.label}</span>;
}

function Avatar({person, size=40}) {
  const name = person.firstName ? fullName(person) : (person.name||"?");
  const initials = person.firstName ? getInitials(person) : (person.avatar||"?");
  const color = getAvatarColor(name);
  return <div style={{width:size,height:size,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",background:`linear-gradient(135deg,${color},${color}dd)`,color:"#fff",fontWeight:700,fontSize:size*.35,flexShrink:0,boxShadow:`0 2px 8px ${color}40`}}>{initials}</div>;
}

function BottomNav({active, onNavigate, unreadCount}) {
  const items = [{id:"home",icon:"ğŸ ",label:"Home"},{id:"absences",icon:"ğŸ“‹",label:"Afwezigheden"},{id:"notifications",icon:"ğŸ””",label:"Meldingen"},{id:"profile",icon:"âš™ï¸",label:"Profiel"}];
  return (
    <nav style={{position:"fixed",bottom:0,left:"50%",transform:"translateX(-50%)",width:"100%",maxWidth:430,background:"rgba(255,255,255,0.92)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",borderTop:"1px solid #E5E7EB",display:"flex",zIndex:100,paddingBottom:"env(safe-area-inset-bottom, 8px)"}}>
      {items.map(it => (
        <button key={it.id} onClick={() => onNavigate(it.id)} style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:2,padding:"10px 0 6px",background:"none",border:"none",cursor:"pointer",position:"relative",color:active===it.id?"#1E3A5F":"#9CA3AF",transition:"color 0.2s"}}>
          <span style={{fontSize:20,lineHeight:1}}>{it.icon}</span>
          <span style={{fontSize:10,fontWeight:active===it.id?700:500,letterSpacing:.2}}>{it.label}</span>
          {it.id==="notifications" && unreadCount>0 && <span style={{position:"absolute",top:4,right:"calc(50% - 16px)",width:16,height:16,borderRadius:"50%",background:"#EF4444",color:"#fff",fontSize:9,fontWeight:700,display:"flex",alignItems:"center",justifyContent:"center"}}>{unreadCount}</span>}
          {active===it.id && <div style={{position:"absolute",top:0,left:"25%",right:"25%",height:2,background:"#1E3A5F",borderRadius:2}} />}
        </button>
      ))}
    </nav>
  );
}

function Header({title, subtitle, rightAction}) {
  return (
    <div style={{padding:"16px 20px 12px",background:"linear-gradient(135deg,#1E3A5F 0%,#2D5A87 100%)",color:"#fff"}}>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}}>
        <div>
          <h1 style={{margin:0,fontSize:22,fontWeight:800,letterSpacing:-.5}}>{title}</h1>
          {subtitle && <p style={{margin:"2px 0 0",fontSize:13,opacity:.8}}>{subtitle}</p>}
        </div>
        {rightAction}
      </div>
    </div>
  );
}

function Card({children, style={}, onClick}) {
  return <div onClick={onClick} style={{background:"#fff",borderRadius:14,padding:16,boxShadow:"0 1px 3px rgba(0,0,0,0.06), 0 4px 12px rgba(0,0,0,0.04)",border:"1px solid #F0F0F0",cursor:onClick?"pointer":"default",transition:"transform 0.15s, box-shadow 0.15s",...style}}>{children}</div>;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCREENS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function HomeScreen({syncData, onNavigate, onNewRequest}) {
  const {user, leaveTypes, requests, teamAbsences, balances} = syncData;
  const today = todayStr();
  const currentYear = new Date().getFullYear();
  const yearBalances = balances[currentYear]||{};
  const upcomingLeave = requests.filter(r => r.status==="approved" && r.startDate>=today).sort((a,b) => a.startDate.localeCompare(b.startDate));
  const todayAbsent = teamAbsences.filter(t => t.startDate<=today && t.endDate>=today);
  const trackedBalances = leaveTypes.filter(t => t.tracked && yearBalances[t.id] && (yearBalances[t.id].allowance>0||yearBalances[t.id].used>0)).map(t => ({...t,...yearBalances[t.id]}));

  const BalanceBox = ({type}) => {
    const pct = type.allowance>0 ? Math.max(0,Math.min(100,(type.remaining/type.allowance)*100)) : 0;
    const accent = type.remaining>5 ? "#10B981" : type.remaining>0 ? "#F59E0B" : "#EF4444";
    return (
      <div style={{flex:1,minWidth:0,background:"#fff",borderRadius:12,padding:"12px 14px",border:"1px solid #E5E7EB"}}>
        <div style={{fontSize:11,fontWeight:700,color:"#6B7280",textTransform:"uppercase",letterSpacing:.6,marginBottom:8,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}>{type.symbol} {type.name}</div>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"baseline",marginBottom:4}}>
          <span style={{fontSize:11,color:"#9CA3AF"}}>Recht</span>
          <span style={{fontSize:16,fontWeight:800,color:"#9CA3AF"}}>{type.allowance}</span>
        </div>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"baseline"}}>
          <span style={{fontSize:11,color:accent,fontWeight:600}}>Resterend</span>
          <span style={{fontSize:22,fontWeight:800,color:accent}}>{type.remaining}</span>
        </div>
        <div style={{marginTop:8,height:4,borderRadius:2,background:"#F3F4F6",overflow:"hidden"}}>
          <div style={{height:"100%",borderRadius:2,background:accent,width:`${pct}%`,transition:"width 0.5s"}} />
        </div>
      </div>
    );
  };

  return (
    <div className="screen">
      <Header title={`Hallo, ${user.firstName} ğŸ‘‹`} subtitle={formatDateFull(today)}
        rightAction={<button onClick={onNewRequest} style={{background:"rgba(255,255,255,0.2)",border:"1px solid rgba(255,255,255,0.3)",borderRadius:12,color:"#fff",padding:"8px 14px",fontSize:13,fontWeight:700,cursor:"pointer",backdropFilter:"blur(4px)",display:"flex",alignItems:"center",gap:6}}><span style={{fontSize:18,lineHeight:1}}>+</span> Aanvragen</button>}
      />
      <div style={{padding:"16px 16px 20px",display:"flex",flexDirection:"column",gap:16}}>
        <Card style={{background:"linear-gradient(135deg,#F0F7FF 0%,#E8F4FD 100%)",border:"1px solid #D0E8F7",padding:12}}>
          <div style={{display:"flex",gap:10,flexWrap:"wrap"}}>
            {trackedBalances.map(t => <BalanceBox key={t.id} type={t} />)}
            {trackedBalances.length===0 && <div style={{color:"#9CA3AF",fontSize:13,padding:8,textAlign:"center",width:"100%"}}>Geen saldo's beschikbaar</div>}
          </div>
        </Card>

        <div>
          <h3 style={{margin:"0 0 10px 4px",fontSize:14,fontWeight:700,color:"#374151",textTransform:"uppercase",letterSpacing:.6}}>ğŸ“… Aankomend Verlof</h3>
          {upcomingLeave.length===0 ? <Card><p style={{color:"#9CA3AF",fontSize:13,margin:0,textAlign:"center",padding:8}}>Geen gepland verlof</p></Card> : (
            <div style={{display:"flex",flexDirection:"column",gap:8}}>
              {upcomingLeave.slice(0,3).map(r => {
                const lt = leaveTypes.find(t => t.id===r.type); if (!lt) return null;
                return (
                  <Card key={r.id} onClick={() => onNavigate("absences")}>
                    <div style={{display:"flex",alignItems:"center",gap:12}}>
                      <div style={{width:42,height:42,borderRadius:12,background:`${lt.color}15`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:20}}>{lt.symbol}</div>
                      <div style={{flex:1}}>
                        <div style={{fontWeight:700,fontSize:14,color:"#1F2937"}}>{lt.name}</div>
                        <div style={{fontSize:12,color:"#6B7280",marginTop:2}}>{formatDate(r.startDate)} â†’ {formatDate(r.endDate)} Â· {r.halfDay ? `Â½ dag (${r.halfDayPeriod==="VM"?"Voormiddag":"Namiddag"})` : `${r.days} dag${r.days>1?"en":""}`}</div>
                      </div>
                      <StatusBadge status={r.status} />
                    </div>
                  </Card>
                );
              })}
            </div>
          )}
        </div>

        <div>
          <h3 style={{margin:"0 0 10px 4px",fontSize:14,fontWeight:700,color:"#374151",textTransform:"uppercase",letterSpacing:.6}}>ğŸ‘¥ Team Afwezig Vandaag</h3>
          {todayAbsent.length===0 ? <Card><p style={{color:"#9CA3AF",fontSize:13,margin:0,textAlign:"center",padding:8}}>Iedereen is aanwezig</p></Card> : (
            <Card>
              <div style={{display:"flex",flexDirection:"column",gap:10}}>
                {todayAbsent.map((t,i) => {
                  const lt = leaveTypes.find(x => x.id===t.type);
                  return (
                    <div key={i} style={{display:"flex",alignItems:"center",gap:12,padding:"4px 0",borderBottom:i<todayAbsent.length-1?"1px solid #F3F4F6":"none"}}>
                      <Avatar person={t} size={36} />
                      <div style={{flex:1}}><div style={{fontWeight:600,fontSize:13,color:"#1F2937"}}>{fullName(t)}</div><div style={{fontSize:11,color:"#6B7280"}}>{lt ? `${lt.symbol} ${lt.name}` : t.type}</div></div>
                      <span style={{fontSize:11,color:"#9CA3AF"}}>tot {formatDate(t.endDate)}</span>
                    </div>
                  );
                })}
              </div>
            </Card>
          )}
        </div>
      </div>
    </div>
  );
}

function NewRequestScreen({syncData, onBack, onSubmit}) {
  const {user, leaveTypes, teamAbsences, balances} = syncData;
  const requestableTypes = getRequestableTypes(leaveTypes);
  const currentYear = new Date().getFullYear();
  const yearBalances = balances[currentYear]||{};
  const [type, setType] = useState("");
  const [startDate, setStartDate] = useState("");
  const [endDate, setEndDate] = useState("");
  const [halfDay, setHalfDay] = useState(false);
  const [halfDayPeriod, setHalfDayPeriod] = useState("VM");
  const [comment, setComment] = useState("");
  const [step, setStep] = useState(1);
  const [showAllTypes, setShowAllTypes] = useState(false);

  const selectedType = leaveTypes.find(t => t.id===type);
  const bal = yearBalances[type];
  const days = startDate && endDate ? (halfDay ? 0.5 : getDaysBetween(startDate,endDate)) : 0;
  const showBalance = bal && bal.allowance>0;
  const canSubmit = type && startDate && endDate && (!showBalance || days<=bal.remaining);
  const overlappingTeam = (startDate && endDate) ? teamAbsences.filter(t => t.startDate<=endDate && t.endDate>=startDate) : [];
  const overlapWarning = overlappingTeam.length>=2;

  const handleSubmit = () => { if (!canSubmit) return; onSubmit({id:"r-"+Date.now(),personId:user.id,type,startDate,endDate,halfDay,halfDayPeriod:halfDay?halfDayPeriod:null,status:"pending",days,comment,requestDate:todayStr()}); };

  return (
    <div className="screen">
      <div style={{padding:"16px 20px 12px",background:"linear-gradient(135deg,#1E3A5F 0%,#2D5A87 100%)",color:"#fff",display:"flex",alignItems:"center",gap:12}}>
        <button onClick={onBack} style={{background:"none",border:"none",color:"#fff",fontSize:22,cursor:"pointer",padding:4}}>â†</button>
        <h1 style={{margin:0,fontSize:20,fontWeight:800}}>Verlof Aanvragen</h1>
      </div>
      <div style={{padding:"16px 16px 20px",display:"flex",flexDirection:"column",gap:16}}>
        <Card>
          <label style={{fontSize:12,fontWeight:700,color:"#6B7280",textTransform:"uppercase",letterSpacing:.8,marginBottom:10,display:"block"}}>â‘  Type Verlof</label>
          {(() => {
            const defaultIds = ["wettelijk","adv","onbetaald"];
            const defaultTypes = requestableTypes.filter(t => defaultIds.includes(t.id));
            const extraTypes = requestableTypes.filter(t => !defaultIds.includes(t.id));
            const selectedInExtra = type && !defaultIds.includes(type);
            const visibleTypes = showAllTypes ? requestableTypes : (selectedInExtra ? [...defaultTypes, requestableTypes.find(t=>t.id===type)].filter(Boolean) : defaultTypes);
            return (<>
              <div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>
                {visibleTypes.map(lt => (
                  <button key={lt.id} onClick={() => {if(lt.id!==type){setStartDate("");setEndDate("");setHalfDay(false);setComment("")} setType(lt.id);setStep(2)}}
                    style={{padding:"12px 10px",borderRadius:12,border:type===lt.id?`2px solid ${lt.color}`:"2px solid #E5E7EB",background:type===lt.id?`${lt.color}10`:"#FAFAFA",cursor:"pointer",display:"flex",alignItems:"center",gap:8,transition:"all 0.2s"}}>
                    <span style={{fontSize:20}}>{lt.symbol}</span>
                    <div style={{textAlign:"left"}}><div style={{fontSize:12,fontWeight:600,color:"#1F2937"}}>{lt.name}</div></div>
                  </button>
                ))}
              </div>
              {extraTypes.length>0 && <button onClick={() => setShowAllTypes(!showAllTypes)} style={{marginTop:10,width:"100%",padding:"10px",borderRadius:10,border:"1.5px dashed #D1D5DB",background:"transparent",cursor:"pointer",fontSize:12,fontWeight:600,color:"#6B7280",display:"flex",alignItems:"center",justifyContent:"center",gap:6,transition:"all 0.2s"}}>{showAllTypes?"â–² Minder types":`â• Meer types (${extraTypes.length})`}</button>}
            </>);
          })()}
        </Card>

        {step>=2 && (
          <Card className="slide-up">
            <label style={{fontSize:12,fontWeight:700,color:"#6B7280",textTransform:"uppercase",letterSpacing:.8,marginBottom:10,display:"block"}}>â‘¡ Datums</label>
            <div style={{display:"flex",gap:10,marginBottom:12}}>
              <div style={{flex:1}}>
                <label style={{fontSize:11,color:"#9CA3AF",display:"block",marginBottom:4}}>Startdatum</label>
                <input type="date" value={startDate} min={todayStr()} onChange={e => {setStartDate(e.target.value);if(!endDate||e.target.value>endDate)setEndDate(e.target.value);setStep(Math.max(step,3))}}
                  style={{width:"100%",padding:"10px 12px",borderRadius:10,border:"1.5px solid #E5E7EB",fontSize:14,fontWeight:600,color:"#1F2937",boxSizing:"border-box"}} />
              </div>
              <div style={{flex:1}}>
                <label style={{fontSize:11,color:"#9CA3AF",display:"block",marginBottom:4}}>Einddatum</label>
                <input type="date" value={endDate} min={startDate||todayStr()} onChange={e => {setEndDate(e.target.value);setStep(Math.max(step,3))}}
                  style={{width:"100%",padding:"10px 12px",borderRadius:10,border:"1.5px solid #E5E7EB",fontSize:14,fontWeight:600,color:"#1F2937",boxSizing:"border-box"}} />
              </div>
            </div>
            <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 0",borderTop:"1px solid #F3F4F6"}}>
              <span style={{fontSize:13,fontWeight:600,color:"#374151"}}>Halve dag?</span>
              <button onClick={() => setHalfDay(!halfDay)} style={{width:48,height:28,borderRadius:14,border:"none",cursor:"pointer",position:"relative",background:halfDay?"#1E3A5F":"#D1D5DB",transition:"background 0.3s"}}>
                <div style={{width:22,height:22,borderRadius:"50%",background:"#fff",position:"absolute",top:3,left:halfDay?23:3,transition:"left 0.3s",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}} />
              </button>
            </div>
            {halfDay && <div style={{display:"flex",gap:8,marginTop:8}}>
              {[{key:"VM",label:"â˜€ï¸ Voormiddag"},{key:"NM",label:"ğŸŒ™ Namiddag"}].map(h => (
                <button key={h.key} onClick={() => setHalfDayPeriod(h.key)} style={{flex:1,padding:"10px",borderRadius:10,border:halfDayPeriod===h.key?"2px solid #1E3A5F":"2px solid #E5E7EB",background:halfDayPeriod===h.key?"#1E3A5F10":"#FAFAFA",cursor:"pointer",fontWeight:600,fontSize:13,color:halfDayPeriod===h.key?"#1E3A5F":"#6B7280"}}>{h.label}</button>
              ))}
            </div>}
          </Card>
        )}

        {step>=2 && (
          <Card className="slide-up">
            <label style={{fontSize:12,fontWeight:700,color:"#6B7280",textTransform:"uppercase",letterSpacing:.8,marginBottom:10,display:"block"}}>ğŸ’¬ Opmerking (optioneel)</label>
            <textarea value={comment} onChange={e => setComment(e.target.value)} placeholder="Bv. reden, extra info..."
              style={{width:"100%",padding:"10px 12px",borderRadius:10,border:"1.5px solid #E5E7EB",fontSize:13,color:"#1F2937",boxSizing:"border-box",minHeight:60,resize:"vertical",fontFamily:"inherit"}} />
          </Card>
        )}

        {step>=3 && startDate && endDate && (
          <Card className="slide-up" style={{background:!showBalance||canSubmit?"linear-gradient(135deg,#F0FDF4,#ECFDF5)":"linear-gradient(135deg,#FEF2F2,#FEE2E2)"}}>
            <label style={{fontSize:12,fontWeight:700,color:"#6B7280",textTransform:"uppercase",letterSpacing:.8,marginBottom:10,display:"block"}}>â‘¢ Overzicht</label>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}>
              <span style={{fontSize:13,color:"#6B7280"}}>Aantal dagen</span>
              <span style={{fontSize:18,fontWeight:800,color:"#1F2937"}}>{days}</span>
            </div>
            {showBalance && (<>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8}}>
                <span style={{fontSize:13,color:"#6B7280"}}>Huidig saldo</span>
                <span style={{fontSize:14,fontWeight:600,color:"#1F2937"}}>{bal.remaining} dagen</span>
              </div>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0 0",borderTop:"1px solid rgba(0,0,0,0.06)"}}>
                <span style={{fontSize:13,fontWeight:600,color:days>bal.remaining?"#DC2626":"#059669"}}>Resterend na aanvraag</span>
                <span style={{fontSize:16,fontWeight:800,color:days>bal.remaining?"#DC2626":"#059669"}}>{bal.remaining-days}</span>
              </div>
              {days>bal.remaining && <p style={{color:"#DC2626",fontSize:12,fontWeight:600,margin:"10px 0 0",textAlign:"center"}}>âš ï¸ Onvoldoende saldo</p>}
            </>)}
          </Card>
        )}

        {step>=3 && startDate && endDate && overlappingTeam.length>0 && (
          <Card className="slide-up" style={{background:overlapWarning?"linear-gradient(135deg,#FFFBEB,#FEF3C7)":"linear-gradient(135deg,#F0F9FF,#E0F2FE)",border:overlapWarning?"1px solid #F59E0B":"1px solid #7DD3FC"}}>
            <div style={{display:"flex",gap:10,alignItems:"flex-start"}}>
              <span style={{fontSize:22,lineHeight:1}}>{overlapWarning?"âš ï¸":"â„¹ï¸"}</span>
              <div style={{flex:1}}>
                <p style={{margin:"0 0 6px",fontSize:13,fontWeight:700,color:overlapWarning?"#92400E":"#0C4A6E"}}>{overlapWarning?"Meerdere collega's al afwezig in deze periode":`${overlappingTeam.length} collega ook afwezig in deze periode`}</p>
                <div style={{display:"flex",flexDirection:"column",gap:6}}>
                  {overlappingTeam.map((t,i) => (
                    <div key={i} style={{display:"flex",alignItems:"center",gap:8}}>
                      <Avatar person={t} size={24} />
                      <div><span style={{fontSize:12,fontWeight:600,color:"#374151"}}>{fullName(t)}</span><span style={{fontSize:11,color:"#6B7280",marginLeft:6}}>{formatDate(t.startDate)} â†’ {formatDate(t.endDate)}</span></div>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </Card>
        )}

        <button onClick={handleSubmit} disabled={!canSubmit}
          style={{padding:"16px",borderRadius:14,border:"none",fontSize:16,fontWeight:800,background:canSubmit?"linear-gradient(135deg,#1E3A5F,#2D5A87)":"#D1D5DB",color:canSubmit?"#fff":"#9CA3AF",cursor:canSubmit?"pointer":"not-allowed",boxShadow:canSubmit?"0 4px 14px rgba(30,58,95,0.35)":"none",transition:"all 0.3s",letterSpacing:.3}}>
          Indienen
        </button>
      </div>
    </div>
  );
}

function AbsencesScreen({syncData, onCancel}) {
  const {leaveTypes, requests, requestsPreviousYear, balances} = syncData;
  const currentYear = new Date().getFullYear();
  const previousYear = currentYear-1;
  const [selectedYear, setSelectedYear] = useState(currentYear);
  const activeRequests = selectedYear===currentYear ? requests : requestsPreviousYear;
  const pending = selectedYear===currentYear ? activeRequests.filter(r=>r.status==="pending").sort((a,b)=>(b.requestDate||"").localeCompare(a.requestDate||"")) : [];
  const history = activeRequests.filter(r=>r.status!=="pending").sort((a,b)=>b.startDate.localeCompare(a.startDate));

  const AbsenceRow = ({item, showCancel}) => {
    const lt = leaveTypes.find(t=>t.id===item.type); if(!lt) return null;
    const isApproved = item.status==="approved";
    const borderColor = item.status==="pending"?"#F59E0B":isApproved?"#10B981":"#EF4444";
    return (
      <Card style={{borderLeft:`4px solid ${borderColor}`}}>
        <div style={{display:"flex",alignItems:"center",gap:12}}>
          <div style={{width:40,height:40,borderRadius:10,background:`${lt.color}12`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:18}}>{lt.symbol}</div>
          <div style={{flex:1}}>
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}>
              <span style={{fontWeight:700,fontSize:13,color:"#1F2937"}}>{lt.name}</span>
              {item.status==="pending" ? <StatusBadge status="pending" /> : <span style={{fontSize:11,fontWeight:700,color:isApproved?"#059669":"#DC2626"}}>{isApproved?"âœ“ Goedgekeurd":"âœ— Afgewezen"}</span>}
            </div>
            <div style={{fontSize:12,color:"#6B7280",marginTop:2}}>{formatDate(item.startDate)}{item.startDate!==item.endDate?` â†’ ${formatDate(item.endDate)}`:""} Â· {item.halfDay?`Â½ dag (${item.halfDayPeriod==="VM"?"VM":"NM"})`:`${item.days} dag${item.days!==1?"en":""}`}</div>
            {item.comment && <div style={{fontSize:11,color:"#6B7280",marginTop:2,fontStyle:"italic"}}>ğŸ’¬ {item.comment}</div>}
            {item.rejectReason && <div style={{fontSize:11,color:"#DC2626",marginTop:3,fontStyle:"italic"}}>Reden: {item.rejectReason}</div>}
          </div>
        </div>
        {showCancel && <button onClick={() => onCancel(item.id)} style={{marginTop:10,width:"100%",padding:"9px",borderRadius:10,border:"1.5px solid #FCA5A5",background:"#FEF2F2",color:"#DC2626",fontSize:12,fontWeight:700,cursor:"pointer"}}>Annuleren</button>}
      </Card>
    );
  };

  const yearBal = balances[selectedYear]||{};
  const trackedBals = leaveTypes.filter(t=>t.tracked&&yearBal[t.id]&&(yearBal[t.id].allowance>0||yearBal[t.id].used>0)).map(t=>({...t,...yearBal[t.id]}));

  return (
    <div className="screen">
      <Header title="Afwezigheden" subtitle={`${activeRequests.length} registraties`} />
      <div style={{padding:"16px 16px 20px",display:"flex",flexDirection:"column",gap:16}}>
        <div style={{display:"flex",gap:8}}>
          {[currentYear,previousYear].map(yr => (
            <button key={yr} onClick={() => setSelectedYear(yr)} style={{flex:1,padding:"10px 0",borderRadius:12,border:"none",fontSize:14,fontWeight:800,cursor:"pointer",background:selectedYear===yr?"linear-gradient(135deg,#1E3A5F,#2D5A87)":"#F3F4F6",color:selectedYear===yr?"#fff":"#6B7280",boxShadow:selectedYear===yr?"0 2px 8px rgba(30,58,95,0.25)":"none",transition:"all 0.2s",letterSpacing:.3}}>{yr===currentYear?`${yr} (huidig)`:yr}</button>
          ))}
        </div>

        {trackedBals.length>0 && (
          <Card style={{background:selectedYear===currentYear?"linear-gradient(135deg,#F0F7FF,#E8F4FD)":"linear-gradient(135deg,#F9FAFB,#F3F4F6)",border:selectedYear===currentYear?"1px solid #D0E8F7":"1px solid #E5E7EB",padding:12}}>
            <div style={{display:"flex",gap:10,flexWrap:"wrap"}}>
              {trackedBals.map(t => {
                const accent = t.remaining>5?"#10B981":t.remaining>0?"#F59E0B":"#EF4444";
                return (
                  <div key={t.id} style={{flex:1,minWidth:90,background:"#fff",borderRadius:10,padding:"10px 12px",border:"1px solid #E5E7EB"}}>
                    <div style={{fontSize:10,fontWeight:700,color:"#6B7280",textTransform:"uppercase",letterSpacing:.5,marginBottom:4,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}>{t.symbol} {t.name}</div>
                    <div style={{display:"flex",justifyContent:"space-between",fontSize:11,color:"#9CA3AF",marginBottom:2}}><span>Recht</span><span style={{fontWeight:700}}>{t.allowance}</span></div>
                    <div style={{display:"flex",justifyContent:"space-between",fontSize:12,color:accent,fontWeight:700}}><span>Rest</span><span style={{fontSize:16,fontWeight:800}}>{t.remaining}</span></div>
                  </div>
                );
              })}
            </div>
            {selectedYear===previousYear && <p style={{margin:"8px 0 0",fontSize:10,color:"#9CA3AF",textAlign:"center",fontStyle:"italic"}}>Archief â€” max. 2 jaar bewaard.</p>}
          </Card>
        )}

        {pending.length>0 && (
          <div>
            <h3 style={{margin:"0 0 8px 4px",fontSize:12,fontWeight:700,color:"#92400E",textTransform:"uppercase",letterSpacing:1,display:"flex",alignItems:"center",gap:6}}>
              <span style={{width:8,height:8,borderRadius:"50%",background:"#F59E0B",display:"inline-block"}} /> In afwachting ({pending.length})
            </h3>
            <div style={{display:"flex",flexDirection:"column",gap:8}}>{pending.map(r => <AbsenceRow key={r.id} item={r} showCancel />)}</div>
          </div>
        )}

        <div>
          <h3 style={{margin:"0 0 8px 4px",fontSize:12,fontWeight:700,color:"#6B7280",textTransform:"uppercase",letterSpacing:1}}>Historiek</h3>
          {history.length===0 ? <Card><p style={{color:"#9CA3AF",fontSize:13,margin:0,textAlign:"center",padding:8}}>Nog geen historiek</p></Card> : (
            <div style={{display:"flex",flexDirection:"column",gap:8}}>{history.map(r => <AbsenceRow key={r.id} item={r} />)}</div>
          )}
        </div>
      </div>
    </div>
  );
}

function NotificationsScreen({notifications, onMarkRead}) {
  const typeIcon = {approved:"âœ…",rejected:"âŒ",info:"â„¹ï¸",change:"ğŸ”„"};
  const typeColor = {approved:"#10B981",rejected:"#EF4444",info:"#3B82F6",change:"#F59E0B"};
  return (
    <div className="screen">
      <Header title="Meldingen" subtitle={`${notifications.filter(n=>!n.read).length} ongelezen`} />
      <div style={{padding:"16px 16px 20px",display:"flex",flexDirection:"column",gap:8}}>
        {notifications.map(n => (
          <Card key={n.id} onClick={() => onMarkRead(n.id)} style={{background:n.read?"#fff":"#F8FAFF",borderLeft:n.read?"none":`3px solid ${typeColor[n.type]}`}}>
            <div style={{display:"flex",gap:12,alignItems:"flex-start"}}>
              <span style={{fontSize:20}}>{typeIcon[n.type]}</span>
              <div style={{flex:1}}>
                <p style={{margin:0,fontSize:13,fontWeight:n.read?400:700,color:"#1F2937",lineHeight:1.4}}>{n.message}</p>
                <span style={{fontSize:11,color:"#9CA3AF",marginTop:4,display:"block"}}>{n.time}</span>
              </div>
              {!n.read && <div style={{width:8,height:8,borderRadius:"50%",background:typeColor[n.type],flexShrink:0,marginTop:4}} />}
            </div>
          </Card>
        ))}
      </div>
    </div>
  );
}

function ProfileScreen({syncData}) {
  const {user, leaveTypes, balances} = syncData;
  const currentYear = new Date().getFullYear();
  const [notifSettings, setNotifSettings] = useState({approvals:true,rejections:true,changes:true,team:false});
  const Toggle = ({on, onToggle}) => (
    <button onClick={onToggle} style={{width:48,height:28,borderRadius:14,border:"none",cursor:"pointer",position:"relative",background:on?"#1E3A5F":"#D1D5DB",transition:"background 0.3s"}}>
      <div style={{width:22,height:22,borderRadius:"50%",background:"#fff",position:"absolute",top:3,left:on?23:3,transition:"left 0.3s",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}} />
    </button>
  );
  const personalInfo = [{label:"ğŸ“± GSM",value:user.gsm||"â€”"},{label:"ğŸ“ Telefoon",value:user.tel||"â€”"},{label:"ğŸ“± Werk GSM",value:user.werkGsm||"â€”"},{label:"âœ‰ï¸ E-mail",value:user.email||"â€”"},{label:"ğŸ¦ IBAN",value:user.iban||"â€”"},{label:"ğŸ‚ Geboortedatum",value:user.birthDate?formatDateFull(user.birthDate):"â€”"},{label:"ğŸ†” Rijksregisternummer",value:user.rrn||"â€”"}].filter(x=>x.value&&x.value!=="â€”");
  const emergencyInfo = [{label:"Naam",value:user.noodNaam||"â€”"},{label:"Relatie",value:user.noodRelatie||"â€”"},{label:"GSM",value:user.noodGsm||"â€”"}].filter(x=>x.value&&x.value!=="â€”");

  return (
    <div className="screen">
      <Header title="Profiel" />
      <div style={{padding:"16px 16px 20px",display:"flex",flexDirection:"column",gap:16}}>
        <Card style={{textAlign:"center",padding:24}}>
          <div style={{display:"flex",justifyContent:"center",marginBottom:12}}><Avatar person={user} size={64} /></div>
          <h2 style={{margin:"0 0 2px",fontSize:20,fontWeight:800,color:"#1F2937"}}>{fullName(user)}</h2>
          <p style={{margin:"0 0 4px",fontSize:13,color:"#6B7280"}}>{user.statuut}</p>
          <span style={{fontSize:12,color:"#9CA3AF",background:"#F3F4F6",padding:"3px 12px",borderRadius:20}}>{user.departmentName}</span>
        </Card>

        <Card>
          <h3 style={{margin:"0 0 12px",fontSize:13,fontWeight:700,color:"#374151",textTransform:"uppercase",letterSpacing:.6}}>Persoonlijke Gegevens</h3>
          {personalInfo.map((item,i) => (
            <div key={i} style={{display:"flex",justifyContent:"space-between",padding:"10px 0",borderBottom:i<personalInfo.length-1?"1px solid #F3F4F6":"none"}}>
              <span style={{fontSize:13,color:"#6B7280"}}>{item.label}</span>
              <span style={{fontSize:13,fontWeight:600,color:"#1F2937"}}>{item.value}</span>
            </div>
          ))}
        </Card>

        {emergencyInfo.length>0 && (
          <Card>
            <h3 style={{margin:"0 0 12px",fontSize:13,fontWeight:700,color:"#374151",textTransform:"uppercase",letterSpacing:.6}}>ğŸš¨ Noodcontact</h3>
            {emergencyInfo.map((item,i) => (
              <div key={i} style={{display:"flex",justifyContent:"space-between",padding:"10px 0",borderBottom:i<emergencyInfo.length-1?"1px solid #F3F4F6":"none"}}>
                <span style={{fontSize:13,color:"#6B7280"}}>{item.label}</span>
                <span style={{fontSize:13,fontWeight:600,color:"#1F2937"}}>{item.value}</span>
              </div>
            ))}
          </Card>
        )}

        <Card>
          <h3 style={{margin:"0 0 12px",fontSize:13,fontWeight:700,color:"#374151",textTransform:"uppercase",letterSpacing:.6}}>Notificaties</h3>
          {[{key:"approvals",label:"Goedkeuringen"},{key:"rejections",label:"Afwijzingen"},{key:"changes",label:"Wijzigingen"},{key:"team",label:"Team afwezigheden"}].map((item,i) => (
            <div key={item.key} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 0",borderBottom:i<3?"1px solid #F3F4F6":"none"}}>
              <span style={{fontSize:13,color:"#374151"}}>{item.label}</span>
              <Toggle on={notifSettings[item.key]} onToggle={() => setNotifSettings(s=>({...s,[item.key]:!s[item.key]}))} />
            </div>
          ))}
        </Card>

        <div style={{textAlign:"center",padding:"8px 0"}}>
          <p style={{fontSize:11,color:"#9CA3AF",margin:0}}>ğŸ”— Verbonden met PersoneelBeheer Desktop</p>
          <p style={{fontSize:10,color:"#D1D5DB",margin:"4px 0 0"}}>Laatste sync: {syncData.lastSync ? new Date(syncData.lastSync).toLocaleDateString("nl-BE",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}) : "â€”"}</p>
        </div>
      </div>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function Toast({message, visible}) {
  return <div style={{position:"fixed",top:visible?60:-60,left:"50%",transform:"translateX(-50%)",zIndex:200,background:"#1F2937",color:"#fff",padding:"10px 24px",borderRadius:12,fontSize:13,fontWeight:600,boxShadow:"0 8px 30px rgba(0,0,0,0.2)",transition:"top 0.4s cubic-bezier(0.34,1.56,0.64,1)",whiteSpace:"nowrap"}}>{message}</div>;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAIN APP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function App() {
  const {syncData, syncing, loading, error, refreshSync, submitRequest, cancelRequest} = useSyncData();
  const [screen, setScreen] = useState("home");
  const [showNewRequest, setShowNewRequest] = useState(false);
  const [notifications, setNotifications] = useState([]);
  const [toast, setToast] = useState({message:"",visible:false});

  // Update notifications wanneer syncData verandert
  useEffect(() => {
    if(syncData.notifications && syncData.notifications.length) setNotifications(syncData.notifications);
  }, [syncData.notifications]);

  const showToast = useCallback((msg) => { setToast({message:msg,visible:true}); setTimeout(() => setToast(t=>({...t,visible:false})),2500); }, []);

  // Loading screen
  if (loading) {
    return (
      <div style={{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",gap:16,background:"linear-gradient(135deg,#1E3A5F 0%,#2D5A87 100%)"}}>
        <div style={{fontSize:40}}>â³</div>
        <div style={{color:"#fff",fontSize:16,fontWeight:600}}>Data laden...</div>
        <div style={{color:"rgba(255,255,255,0.6)",fontSize:13}}>Verbinden met Firestore</div>
      </div>
    );
  }

  // Error screen
  if (error || !syncData.user) {
    return (
      <div style={{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",gap:16,padding:32,textAlign:"center"}}>
        <div style={{fontSize:40}}>âš ï¸</div>
        <div style={{fontSize:16,fontWeight:600,color:"#1F2937"}}>{error || "Geen gebruiker gevonden"}</div>
        <div style={{fontSize:13,color:"#6B7280"}}>Zorg ervoor dat personeelbeheer minstens Ã©Ã©n keer is geladen zodat de data in Firestore beschikbaar is.</div>
        <button onClick={refreshSync} style={{marginTop:8,padding:"10px 24px",background:"#1E3A5F",color:"#fff",border:"none",borderRadius:10,fontSize:14,fontWeight:600,cursor:"pointer"}}>Opnieuw proberen</button>
      </div>
    );
  }

  const handleSubmitRequest = async (req) => {
    const result = await submitRequest(req);
    if (result.success) { setShowNewRequest(false); setScreen("absences"); showToast("âœ… Verlofaanvraag ingediend!");
      setNotifications(prev => [{id:Date.now(),type:"info",message:"Nieuwe aanvraag ingediend â€” in afwachting van goedkeuring",time:"Zojuist",read:false},...prev]);
    }
  };

  const handleCancelRequest = async (id) => { const result = await cancelRequest(id); if(result.success) showToast("Aanvraag geannuleerd"); };
  const handleMarkRead = (id) => { setNotifications(prev => prev.map(n => n.id===id ? {...n,read:true} : n)); };
  const unreadCount = notifications.filter(n=>!n.read).length;

  return (
    <>
      <Toast message={toast.message} visible={toast.visible} />
      {showNewRequest ? (
        <NewRequestScreen syncData={syncData} onBack={() => setShowNewRequest(false)} onSubmit={handleSubmitRequest} />
      ) : (<>
        {screen==="home" && <HomeScreen syncData={syncData} onNavigate={setScreen} onNewRequest={() => setShowNewRequest(true)} />}
        {screen==="absences" && <AbsencesScreen syncData={syncData} onCancel={handleCancelRequest} />}
        {screen==="notifications" && <NotificationsScreen notifications={notifications} onMarkRead={handleMarkRead} />}
        {screen==="profile" && <ProfileScreen syncData={syncData} />}
      </>)}
      {!showNewRequest && <BottomNav active={screen} onNavigate={setScreen} unreadCount={unreadCount} />}
    </>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>
</body>
</html>
