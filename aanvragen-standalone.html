<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aanvragen ‚Äî Personeelbeheer</title>
<style>
:root{--bg:#f1f5f9;--card:#fff;--border:#e2e8f0;--text1:#0f172a;--text2:#475569;--text3:#94a3b8;--accent:#3b82f6;--green:#16a34a;--greenbg:#dcfce7;--red:#dc2626;--redbg:#fee2e2;--yellow:#eab308;--yellowbg:#fefce8;--radius:10px}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:var(--bg);color:var(--text1);min-height:100vh}

/* Header */
.header{background:var(--card);border-bottom:1px solid var(--border);padding:20px 24px}
.header-top{display:flex;align-items:center;gap:12px;margin-bottom:16px}
.logo{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,#3b82f6,#1d4ed8);display:flex;align-items:center;justify-content:center;color:#fff;font-size:16px}
.header h1{font-size:18px;font-weight:700}
.header .sub{font-size:12px;color:var(--text3)}
.live-badge{margin-left:auto;background:#dcfce7;color:#166534;padding:4px 12px;border-radius:6px;font-size:11px;font-weight:600;display:flex;align-items:center;gap:4px}
.live-dot{width:6px;height:6px;border-radius:50%;background:#16a34a;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}

/* Stats */
.stats{display:flex;gap:12px}
.stat{flex:1;border-radius:var(--radius);padding:12px 16px;border:1px solid transparent}
.stat-val{font-size:24px;font-weight:700}
.stat-label{font-size:10px;font-weight:600;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-top:2px}
.stat-row{display:flex;align-items:center;justify-content:space-between}
.stat-icon{font-size:20px;opacity:.6}

/* Tabs */
.tabs-bar{display:flex;background:var(--card);border-bottom:1px solid var(--border);padding:0 24px}
.tab{padding:11px 18px;border:none;border-bottom:2px solid transparent;background:none;color:var(--text3);font-weight:600;font-size:13px;cursor:pointer;display:flex;align-items:center;gap:6px}
.tab.active{color:var(--accent);border-bottom-color:var(--accent)}
.tab-badge{background:#ef4444;color:#fff;font-size:10px;font-weight:700;padding:1px 6px;border-radius:10px}

/* Filters */
.filters{padding:14px 24px;display:flex;gap:6px;align-items:center;flex-wrap:wrap}
.filter-btn{padding:5px 12px;border-radius:7px;border:1px solid var(--border);background:var(--card);color:var(--text2);font-size:12px;font-weight:500;cursor:pointer;transition:all .15s}
.filter-btn.active{border-color:var(--accent);background:#eff6ff;color:var(--accent)}
.search-input{margin-left:auto;padding:6px 12px;border:1px solid var(--border);border-radius:7px;font-size:12px;width:180px;outline:none}
.search-input:focus{border-color:var(--accent)}

/* Table */
.table-wrap{padding:0 24px 24px}
.table-card{background:var(--card);border-radius:var(--radius);border:1px solid var(--border);overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,.04)}
table{width:100%;border-collapse:collapse;font-size:13px}
th{text-align:left;padding:10px 14px;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:var(--text3);border-bottom:2px solid var(--border)}
th:last-child{text-align:right}
td{padding:10px 14px;border-bottom:1px solid #f1f5f9}
tr:hover td{background:#f8fafc}

/* Avatar */
.avatar{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-size:11px;font-weight:700;flex-shrink:0}
.person{display:flex;align-items:center;gap:8px}
.person-name{font-weight:600;font-size:13px}
.person-comment{font-size:11px;color:var(--text3);margin-top:1px}

/* Badges */
.type-badge{padding:3px 10px;border-radius:6px;font-size:12px;font-weight:500}
.status-badge{padding:3px 10px;border-radius:6px;font-size:12px;font-weight:600;white-space:nowrap}

/* Action buttons */
.actions{display:flex;gap:4px;justify-content:flex-end}
.btn-approve,.btn-reject{padding:5px 12px;border-radius:6px;border:none;font-size:11px;font-weight:600;cursor:pointer;transition:transform .1s}
.btn-approve{background:var(--greenbg);color:var(--green)}
.btn-reject{background:var(--redbg);color:var(--red)}
.btn-approve:active,.btn-reject:active{transform:scale(.95)}

/* Empty state */
.empty{text-align:center;padding:48px;color:var(--text3)}
.empty-icon{font-size:36px;margin-bottom:8px}

/* Footer */
.table-footer{margin-top:10px;font-size:11px;color:var(--text3);display:flex;justify-content:space-between}

/* Toast */
.toast{position:fixed;top:16px;right:16px;background:#0f172a;color:#fff;padding:10px 20px;border-radius:8px;font-size:13px;font-weight:600;z-index:999;box-shadow:0 4px 12px rgba(0,0,0,.15);animation:slideIn .3s ease;opacity:0;pointer-events:none;transition:opacity .3s}
.toast.show{opacity:1}
@keyframes slideIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}

/* Loading */
.loading{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh}
.spinner{width:36px;height:36px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>
<body>

<div id="toast" class="toast"></div>
<div id="app">
  <div class="loading">
    <div class="spinner"></div>
    <p style="color:#64748b;font-size:14px;margin-top:16px">Verbinden met database...</p>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script>
// ‚ïê‚ïê‚ïê FIREBASE ‚ïê‚ïê‚ïê
firebase.initializeApp({apiKey:"AIzaSyBKU-wCjV4Au4ngRG52Zmmxbzc3N3D8VBU",authDomain:"advanced-intranet.firebaseapp.com",projectId:"advanced-intranet",storageBucket:"advanced-intranet.firebasestorage.app",messagingSenderId:"309856938024",appId:"1:309856938024:web:2108715f92c5dea2da2d1d"});
var db=firebase.firestore();

// ‚ïê‚ïê‚ïê STATE ‚ïê‚ïê‚ïê
var people=[],departments=[],leaveTypes=[],requests=[];
var currentFilter='pending',currentTab='aanvragen',searchQuery='';

// ‚ïê‚ïê‚ïê HELPERS ‚ïê‚ïê‚ïê
var COLORS=["#3b82f6","#22c55e","#a855f7","#ef4444","#eab308","#ec4899","#06b6d4","#f97316"];
function avatarColor(n){var h=0;for(var i=0;i<n.length;i++)h=n.charCodeAt(i)+((h<<5)-h);return COLORS[Math.abs(h)%COLORS.length]}
function initials(n){return n.split(' ').map(function(w){return w[0]}).join('').toUpperCase().slice(0,2)}
function fmtDate(d){try{return new Date(d).toLocaleDateString('nl-BE',{day:'2-digit',month:'short'})}catch(e){return d}}
function getName(id){var p=people.find(function(x){return x.id===id});return p?p.firstName+' '+p.lastName:'Onbekend'}
function getDept(id){var p=people.find(function(x){return x.id===id});if(!p)return'';var d=departments.find(function(x){return x.id===p.departmentId});return d?d.name:''}
function getType(id){return leaveTypes.find(function(t){return t.id===id})||{name:id,symbol:'üìã',color:'#94a3b8'}}
function today(){return new Date().toISOString().split('T')[0]}

function showToast(msg){
  var t=document.getElementById('toast');
  t.textContent=msg;t.classList.add('show');
  setTimeout(function(){t.classList.remove('show')},2500);
}

// ‚ïê‚ïê‚ïê RENDER ‚ïê‚ïê‚ïê
function render(){
  var td=today();
  var nonSick=requests.filter(function(r){return r.type!=='ziekte'});
  var sick=requests.filter(function(r){return r.type==='ziekte'});
  var pending=nonSick.filter(function(r){return r.status==='pending'}).length;
  var absToday=requests.filter(function(r){return r.status==='approved'&&r.startDate<=td&&r.endDate>=td}).length;
  var sickToday=sick.filter(function(r){return r.startDate<=td&&r.endDate>=td}).length;

  var filtered=currentTab==='ziekte'?sick:nonSick;
  if(currentFilter!=='all')filtered=filtered.filter(function(r){return r.status===currentFilter});
  if(searchQuery){var q=searchQuery.toLowerCase();filtered=filtered.filter(function(r){return getName(r.personId).toLowerCase().includes(q)})}
  filtered.sort(function(a,b){return new Date(b.startDate)-new Date(a.startDate)});

  var html='';
  // Header
  html+='<div class="header">';
  html+='<div class="header-top">';
  html+='<div class="logo">üìã</div>';
  html+='<div><h1>Personeelbeheer</h1><p class="sub">Advanced Energy</p></div>';
  html+='<div class="live-badge"><span class="live-dot"></span> Live Sync</div>';
  html+='</div>';
  // Stats
  html+='<div class="stats">';
  var stats=[
    {v:pending,l:'Openstaand',c:'#eab308',bg:'#fefce8',icon:'‚è≥'},
    {v:absToday,l:'Afwezig vandaag',c:'#3b82f6',bg:'#eff6ff',icon:'üèñ'},
    {v:sickToday,l:'Ziek vandaag',c:'#ef4444',bg:'#fef2f2',icon:'ü§í'},
    {v:requests.length,l:'Totaal',c:'#64748b',bg:'#f8fafc',icon:'üìä'}
  ];
  stats.forEach(function(s){
    html+='<div class="stat" style="background:'+s.bg+';border-color:'+s.c+'22">';
    html+='<div class="stat-row"><div class="stat-val" style="color:'+s.c+'">'+s.v+'</div><div class="stat-icon">'+s.icon+'</div></div>';
    html+='<div class="stat-label">'+s.l+'</div></div>';
  });
  html+='</div></div>';

  // Tabs
  html+='<div class="tabs-bar">';
  [{id:'aanvragen',l:'üì• Aanvragen',b:pending},{id:'ziekte',l:'ü§í Ziekte',b:sickToday}].forEach(function(t){
    html+='<button class="tab'+(currentTab===t.id?' active':'')+'" onclick="switchTab(\''+t.id+'\')">'+t.l;
    if(t.b>0)html+='<span class="tab-badge">'+t.b+'</span>';
    html+='</button>';
  });
  html+='</div>';

  // Filters
  html+='<div class="filters">';
  var filters=currentTab==='aanvragen'?
    [{id:'pending',l:'‚è≥ Openstaand'},{id:'approved',l:'‚úÖ Goedgekeurd'},{id:'rejected',l:'‚ùå Geweigerd'},{id:'all',l:'Alles'}]:
    [{id:'all',l:'Alle meldingen'},{id:'approved',l:'Actief'}];
  filters.forEach(function(f){
    html+='<button class="filter-btn'+(currentFilter===f.id?' active':'')+'" onclick="setFilter(\''+f.id+'\')">'+f.l+'</button>';
  });
  html+='<input class="search-input" type="text" placeholder="üîç Zoek op naam..." value="'+searchQuery+'" oninput="doSearch(this.value)"/>';
  html+='</div>';

  // Table
  html+='<div class="table-wrap"><div class="table-card">';
  if(filtered.length===0){
    html+='<div class="empty"><div class="empty-icon">üì≠</div><div>Geen aanvragen gevonden</div></div>';
  }else{
    html+='<table><thead><tr>';
    ['Medewerker','Afdeling','Type','Periode','Dagen','Status',''].forEach(function(h,i){
      html+='<th'+(i===6?' style="text-align:right"':'')+'>'+h+'</th>';
    });
    html+='</tr></thead><tbody>';
    filtered.forEach(function(r,idx){
      var n=getName(r.personId);
      var t=getType(r.type);
      var dept=getDept(r.personId);
      var statusMap={pending:['#fef3c7','#92400e','‚è≥ Openstaand'],approved:['#dcfce7','#166534','‚úÖ Goedgekeurd'],rejected:['#fee2e2','#991b1b','‚ùå Geweigerd']};
      var st=statusMap[r.status]||statusMap.pending;

      html+='<tr>';
      // Medewerker
      html+='<td><div class="person">';
      html+='<div class="avatar" style="background:'+avatarColor(n)+'">'+initials(n)+'</div>';
      html+='<div><div class="person-name">'+n+'</div>';
      if(r.comment)html+='<div class="person-comment">üí¨ '+r.comment+'</div>';
      html+='</div></div></td>';
      // Afdeling
      html+='<td style="color:var(--text3);font-size:12px">'+dept+'</td>';
      // Type
      html+='<td><span class="type-badge" style="background:'+t.color+'15;color:'+t.color+'">'+(t.symbol||'üìã')+' '+t.name+'</span></td>';
      // Periode
      html+='<td style="font-size:12px;white-space:nowrap;color:var(--text2)">'+fmtDate(r.startDate);
      if(r.startDate!==r.endDate)html+=' ‚Üí '+fmtDate(r.endDate);
      html+='</td>';
      // Dagen
      html+='<td style="font-weight:600">'+(r.halfDay?'¬Ω dag':(r.days||1)+'d')+'</td>';
      // Status
      html+='<td><span class="status-badge" style="background:'+st[0]+';color:'+st[1]+'">'+st[2]+'</span></td>';
      // Acties
      html+='<td style="text-align:right">';
      if(r.status==='pending'){
        html+='<div class="actions">';
        html+='<button class="btn-approve" onclick="doApprove(\''+r.id+'\')">‚úÖ Goedkeuren</button>';
        html+='<button class="btn-reject" onclick="doReject(\''+r.id+'\')">‚ùå Weigeren</button>';
        html+='</div>';
      }
      html+='</td></tr>';
    });
    html+='</tbody></table>';
  }
  html+='</div>';
  html+='<div class="table-footer"><span>'+filtered.length+' aanvra'+(filtered.length===1?'ag':'gen')+'</span><span>Real-time sync actief üü¢</span></div>';
  html+='</div>';

  document.getElementById('app').innerHTML=html;
}

// ‚ïê‚ïê‚ïê ACTIONS ‚ïê‚ïê‚ïê
function switchTab(t){currentTab=t;currentFilter=t==='ziekte'?'all':'pending';render()}
function setFilter(f){currentFilter=f;render()}
function doSearch(v){searchQuery=v;render()}

function doApprove(id){
  requests=requests.map(function(r){return r.id===id?Object.assign({},r,{status:'approved'}):r});
  saveRequests();
  showToast('‚úÖ Goedgekeurd: '+getName(requests.find(function(r){return r.id===id}).personId));
  render();
}
function doReject(id){
  requests=requests.map(function(r){return r.id===id?Object.assign({},r,{status:'rejected'}):r});
  saveRequests();
  showToast('‚ùå Geweigerd: '+getName(requests.find(function(r){return r.id===id}).personId));
  render();
}

function saveRequests(){
  db.collection('platform').doc('personeelbeheer').update({
    requests:JSON.stringify(requests),
    updatedAt:new Date().toISOString()
  }).catch(function(e){console.error('Save error:',e)});
}

// ‚ïê‚ïê‚ïê FIRESTORE LISTENER ‚ïê‚ïê‚ïê
db.collection('platform').doc('personeelbeheer').onSnapshot(function(doc){
  if(!doc.exists)return;
  var data=doc.data();
  if(data.people)people=JSON.parse(data.people);
  if(data.departments)departments=JSON.parse(data.departments);
  if(data.leaveTypes)leaveTypes=JSON.parse(data.leaveTypes);
  if(data.requests)requests=JSON.parse(data.requests);
  render();
},function(err){
  document.getElementById('app').innerHTML='<div class="loading"><p style="font-size:40px">‚ö†Ô∏è</p><h3>Verbinding mislukt</h3><p style="color:#64748b">'+err.message+'</p></div>';
});
</script>
</body>
</html>
