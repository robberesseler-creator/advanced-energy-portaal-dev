<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard ‚Äî Personeelbeheer</title>
<style>
:root{--bg:#f1f5f9;--card:#fff;--border:#e2e8f0;--text1:#0f172a;--text2:#475569;--text3:#94a3b8;--accent:#3b82f6;--green:#16a34a;--red:#dc2626;--yellow:#eab308;--radius:10px}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:var(--bg);color:var(--text1)}
.header{background:var(--card);border-bottom:1px solid var(--border);padding:20px 24px}
.header h1{font-size:20px;font-weight:700;margin-bottom:4px}
.header .sub{font-size:12px;color:var(--text3)}
.stats{display:flex;gap:12px;margin-top:16px}
.stat{flex:1;border-radius:var(--radius);padding:14px 18px;border:1px solid transparent;text-align:center}
.stat-val{font-size:32px;font-weight:700}
.stat-label{font-size:10px;font-weight:600;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-top:4px}
.content{padding:20px 24px;display:flex;gap:16px;flex-wrap:wrap}
.card{background:var(--card);border-radius:var(--radius);border:1px solid var(--border);padding:18px;flex:1;min-width:300px}
.card-title{font-size:14px;font-weight:700;margin-bottom:14px;display:flex;align-items:center;gap:8px}
.person-row{display:flex;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid #f1f5f9}
.person-row:last-child{border:none}
.avatar{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-size:11px;font-weight:700;flex-shrink:0}
.person-name{font-weight:600;font-size:13px}
.person-dept{font-size:11px;color:var(--text3)}
.badge{padding:2px 8px;border-radius:5px;font-size:11px;font-weight:600;margin-left:auto;white-space:nowrap}
.section-title{font-size:12px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin:14px 0 8px;padding-top:10px;border-top:1px solid #f1f5f9}
.section-title:first-child{border:none;margin-top:0;padding-top:0}
.full-width{flex-basis:100%}
.holiday-row{display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid #f1f5f9;font-size:13px}
.holiday-row:last-child{border:none}
.holiday-flag{margin-right:8px}
.holiday-date{color:var(--text3);font-size:12px}
.empty{color:var(--text3);font-size:13px;padding:12px 0}
.loading{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh}
.spinner{width:36px;height:36px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.req-row{display:flex;align-items:center;gap:10px;padding:8px 0;border-bottom:1px solid #f1f5f9}
.req-row:last-child{border:none}
.req-dates{font-size:11px;color:var(--text3)}
.req-actions{margin-left:auto;display:flex;gap:4px}
.btn-sm{padding:3px 8px;border-radius:5px;border:none;font-size:10px;font-weight:600;cursor:pointer}
</style>
</head>
<body>
<div id="app"><div class="loading"><div class="spinner"></div><p style="color:#64748b;font-size:14px;margin-top:16px">Laden...</p></div></div>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script>
firebase.initializeApp({apiKey:"AIzaSyBKU-wCjV4Au4ngRG52Zmmxbzc3N3D8VBU",authDomain:"advanced-intranet.firebaseapp.com",projectId:"advanced-intranet",storageBucket:"advanced-intranet.firebasestorage.app",messagingSenderId:"309856938024",appId:"1:309856938024:web:2108715f92c5dea2da2d1d"});
var db=firebase.firestore();
var people=[],departments=[],leaveTypes=[],requests=[];

var COLORS=["#3b82f6","#22c55e","#a855f7","#ef4444","#eab308","#ec4899","#06b6d4","#f97316"];
function ac(n){var h=0;for(var i=0;i<n.length;i++)h=n.charCodeAt(i)+((h<<5)-h);return COLORS[Math.abs(h)%COLORS.length]}
function ini(n){return n.split(' ').map(function(w){return w[0]}).join('').toUpperCase().slice(0,2)}
function gN(id){var p=people.find(function(x){return x.id===id});return p?p.firstName+' '+p.lastName:'?'}
function gD(id){var p=people.find(function(x){return x.id===id});if(!p)return'';var d=departments.find(function(x){return x.id===p.departmentId});return d?d.name:''}
function gT(id){return leaveTypes.find(function(t){return t.id===id})||{name:id,symbol:'üìã',color:'#94a3b8'}}
function fD(d){try{return new Date(d).toLocaleDateString('nl-BE',{day:'2-digit',month:'short'})}catch(e){return d}}

var BE_HOLIDAYS=[
  {name:'Paasmaandag',date:'2026-04-06'},{name:'Dag van de Arbeid',date:'2026-05-01'},
  {name:'O.L.H. Hemelvaart',date:'2026-05-14'},{name:'Pinkstermaandag',date:'2026-05-25'},
  {name:'Nationale feestdag',date:'2026-07-21'},{name:'Vlaamse feestdag',date:'2026-07-11'},
  {name:'O.L.V. Hemelvaart',date:'2026-08-15'},{name:'Allerheiligen',date:'2026-11-01'},
  {name:'Wapenstilstand',date:'2026-11-11'},{name:'Kerstmis',date:'2026-12-25'}
];

function render(){
  var td=new Date().toISOString().split('T')[0];
  var approved=requests.filter(function(r){return r.status==='approved'&&r.startDate<=td&&r.endDate>=td});
  var absent=approved.filter(function(r){return r.type!=='ziekte'});
  var sick=approved.filter(function(r){return r.type==='ziekte'});
  var pending=requests.filter(function(r){return r.status==='pending'&&r.type!=='ziekte'});
  var upcoming=BE_HOLIDAYS.filter(function(h){return h.date>=td}).slice(0,5);

  var h='<div class="header"><h1>Dashboard</h1><p class="sub">Overzicht verlof en afwezigheden</p>';
  h+='<div class="stats">';
  h+='<div class="stat" style="background:#eff6ff;border-color:#3b82f622"><div class="stat-val" style="color:#3b82f6">'+absent.length+'</div><div class="stat-label">Afwezig vandaag</div></div>';
  h+='<div class="stat" style="background:#fef2f2;border-color:#ef444422"><div class="stat-val" style="color:#ef4444">'+sick.length+'</div><div class="stat-label">Ziek vandaag</div></div>';
  h+='<div class="stat" style="background:#fefce8;border-color:#eab30822"><div class="stat-val" style="color:#eab308">'+pending.length+'</div><div class="stat-label">Openstaande aanvragen</div></div>';
  h+='</div></div>';

  h+='<div class="content">';
  // Afwezig vandaag
  h+='<div class="card"><div class="card-title">üìÖ Afwezig vandaag</div>';
  if(absent.length===0&&sick.length===0){h+='<div class="empty">Niemand afwezig vandaag</div>';}
  else{
    if(absent.length>0){
      absent.forEach(function(r){
        var n=gN(r.personId),t=gT(r.type);
        h+='<div class="person-row"><div class="avatar" style="background:'+ac(n)+'">'+ini(n)+'</div>';
        h+='<div><div class="person-name">'+n+'</div><div class="person-dept">'+gD(r.personId)+'</div></div>';
        h+='<div class="badge" style="background:'+t.color+'15;color:'+t.color+'">'+t.symbol+' '+t.name+'</div></div>';
      });
    }
    if(sick.length>0){
      h+='<div class="section-title">ü§í Ziek vandaag</div>';
      sick.forEach(function(r){
        var n=gN(r.personId);
        h+='<div class="person-row"><div class="avatar" style="background:'+ac(n)+'">'+ini(n)+'</div>';
        h+='<div><div class="person-name">'+n+'</div><div class="person-dept">'+gD(r.personId)+' ¬∑ sinds '+fD(r.startDate)+'</div></div></div>';
      });
    }
  }
  h+='</div>';

  // Openstaande aanvragen
  h+='<div class="card"><div class="card-title">üì• Openstaande aanvragen</div>';
  if(pending.length===0){h+='<div class="empty">Geen openstaande aanvragen</div>';}
  else{
    pending.slice(0,8).forEach(function(r){
      var n=gN(r.personId),t=gT(r.type);
      h+='<div class="req-row"><div class="avatar" style="background:'+ac(n)+'">'+ini(n)+'</div>';
      h+='<div><div class="person-name">'+n+'</div><div class="req-dates">'+fD(r.startDate)+' ‚Üí '+fD(r.endDate)+'</div></div>';
      h+='<div class="badge" style="background:'+t.color+'15;color:'+t.color+'">'+t.symbol+'</div>';
      h+='<div class="req-actions">';
      h+='<button class="btn-sm" style="background:#dcfce7;color:#166534" onclick="doApprove(\''+r.id+'\')">‚úÖ</button>';
      h+='<button class="btn-sm" style="background:#fee2e2;color:#991b1b" onclick="doReject(\''+r.id+'\')">‚ùå</button>';
      h+='</div></div>';
    });
    if(pending.length>8)h+='<div style="padding:8px 0;font-size:12px;color:var(--text3)">+ '+(pending.length-8)+' meer...</div>';
  }
  h+='</div>';

  // Feestdagen
  h+='<div class="card full-width"><div class="card-title">üáßüá™ Aankomende feestdagen</div>';
  upcoming.forEach(function(hol){
    h+='<div class="holiday-row"><span><span class="holiday-flag">üáßüá™</span>'+hol.name+'</span><span class="holiday-date">'+new Date(hol.date).toLocaleDateString('nl-BE',{day:'2-digit',month:'2-digit',year:'numeric'})+'</span></div>';
  });
  h+='</div>';
  h+='</div>';

  document.getElementById('app').innerHTML=h;
}

function doApprove(id){
  requests=requests.map(function(r){return r.id===id?Object.assign({},r,{status:'approved'}):r});
  db.collection('platform').doc('personeelbeheer').update({requests:JSON.stringify(requests),updatedAt:new Date().toISOString()});
  render();
}
function doReject(id){
  requests=requests.map(function(r){return r.id===id?Object.assign({},r,{status:'rejected'}):r});
  db.collection('platform').doc('personeelbeheer').update({requests:JSON.stringify(requests),updatedAt:new Date().toISOString()});
  render();
}

db.collection('platform').doc('personeelbeheer').onSnapshot(function(doc){
  if(!doc.exists)return;var d=doc.data();
  if(d.people)people=JSON.parse(d.people);
  if(d.departments)departments=JSON.parse(d.departments);
  if(d.leaveTypes)leaveTypes=JSON.parse(d.leaveTypes);
  if(d.requests)requests=JSON.parse(d.requests);
  render();
});
</script>
</body>
</html>
